<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>AMN Â· Panel Admin</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700;800;900&family=Barlow:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOKENS â€” AMN DARK SPORT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:    #0a0d0f;
  --bg2:   #0e1215;
  --bg3:   #131a1f;
  --bg4:   #192028;
  --bg5:   #1e2830;

  --neon:  #39FF14;
  --neon2: rgba(57,255,20,.1);
  --neon3: rgba(57,255,20,.25);
  --neon4: rgba(57,255,20,.5);
  --neon-glow: 0 0 20px rgba(57,255,20,.4);

  --gold:  #FFB800;
  --gold2: rgba(255,184,0,.12);
  --red:   #FF3B3B;
  --red2:  rgba(255,59,59,.12);
  --blue:  #3B9EFF;
  --blue2: rgba(59,158,255,.12);
  --gray:  #8899A6;

  --border:  rgba(255,255,255,.06);
  --border2: rgba(255,255,255,.1);
  --border-neon: rgba(57,255,20,.2);

  --t1: #E8F4FF;
  --t2: #6B8090;
  --t3: #3A4F5E;

  --fh: 'Barlow Condensed', sans-serif;
  --fb: 'Barlow', sans-serif;

  --sidebar: 210px;
  --topbar:  56px;
}

html,body{height:100%;overflow:hidden}
body{background:var(--bg);color:var(--t1);font-family:var(--fb);font-size:14px}

/* â•â•â• SCANLINE TEXTURE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
body::before{
  content:'';position:fixed;inset:0;z-index:0;pointer-events:none;
  background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,.03) 2px,rgba(0,0,0,.03) 4px);
}

/* â•â•â• LOGIN SCREEN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#login-screen{
  position:fixed;inset:0;z-index:1000;
  background:var(--bg);
  display:flex;align-items:center;justify-content:center;
  transition:opacity .5s, transform .5s;
}
#login-screen.hiding{opacity:0;transform:scale(1.05);pointer-events:none}

.login-box{
  background:var(--bg3);
  border:1px solid var(--border2);
  border-radius:16px;
  padding:44px 40px;
  width:100%;max-width:420px;
  text-align:center;
  position:relative;
  box-shadow:0 0 60px rgba(0,0,0,.8), 0 0 0 1px var(--border);
}
.login-box::before{
  content:'';position:absolute;top:-1px;left:20%;right:20%;height:2px;
  background:linear-gradient(90deg,transparent,var(--neon),transparent);
  border-radius:2px;
}
.login-eyebrow{
  font-family:var(--fh);font-size:11px;font-weight:700;letter-spacing:3px;
  text-transform:uppercase;color:var(--neon);margin-bottom:12px;
}
.login-title{
  font-family:var(--fh);font-size:48px;font-weight:900;letter-spacing:2px;
  text-transform:uppercase;color:var(--t1);margin-bottom:32px;line-height:1;
}
.pin-display{
  display:flex;gap:12px;justify-content:center;margin-bottom:24px;
}
.pin-dot{
  width:14px;height:14px;border-radius:50%;
  background:var(--bg5);border:2px solid var(--border2);
  transition:all .2s;
}
.pin-dot.filled{background:var(--neon);border-color:var(--neon);box-shadow:0 0 10px rgba(57,255,20,.5)}

.pin-input{
  width:100%;padding:16px;border-radius:10px;
  background:var(--bg2);border:1px solid var(--border2);
  color:var(--t1);font-size:16px;font-family:var(--fb);text-align:center;
  letter-spacing:8px;outline:none;
  transition:all .2s;
  -webkit-text-security:disc;
}
.pin-input:focus{border-color:var(--border-neon);box-shadow:0 0 0 3px rgba(57,255,20,.08)}

.login-btn{
  width:100%;padding:16px;margin-top:14px;border-radius:10px;
  background:var(--neon);color:#000;
  font-family:var(--fh);font-size:18px;font-weight:900;letter-spacing:3px;text-transform:uppercase;
  border:none;cursor:pointer;
  transition:all .25s;
  display:flex;align-items:center;justify-content:center;gap:10px;
}
.login-btn:hover{box-shadow:var(--neon-glow), 0 0 40px rgba(57,255,20,.3);transform:translateY(-1px)}
.login-btn:active{transform:translateY(0)}
.login-hint{margin-top:16px;font-size:12px;color:var(--t3);letter-spacing:.5px}
.login-error{color:var(--red);font-size:12px;margin-top:8px;min-height:18px}

/* â•â•â• MAIN LAYOUT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#app{display:none;height:100%;position:relative;z-index:1}
#app.visible{display:flex}

/* â•â•â• SIDEBAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sidebar{
  width:var(--sidebar);min-height:100vh;
  background:var(--bg2);
  border-right:1px solid var(--border);
  display:flex;flex-direction:column;
  position:fixed;top:0;left:0;bottom:0;z-index:100;
  flex-shrink:0;
}

.sb-brand{
  padding:18px 16px;border-bottom:1px solid var(--border);
  display:flex;align-items:center;gap:10px;
}
.sb-logo-mark{
  width:34px;height:34px;background:var(--neon);border-radius:7px;
  display:flex;align-items:center;justify-content:center;flex-shrink:0;
}
.sb-logo-mark span{font-family:var(--fh);font-size:16px;font-weight:900;color:#000}
.sb-brand-text{}
.sb-brand-name{font-family:var(--fh);font-size:20px;font-weight:900;letter-spacing:1px;color:var(--t1);line-height:1}
.sb-brand-sub{font-size:9px;text-transform:uppercase;letter-spacing:2px;color:var(--t3);font-weight:600}

.sb-section{
  padding:16px 14px 4px;
  font-size:9px;text-transform:uppercase;letter-spacing:2px;color:var(--t3);font-weight:700;
}
.sb-nav{flex:1;padding:8px 10px;display:flex;flex-direction:column;gap:2px;overflow-y:auto}

.sb-item{
  display:flex;align-items:center;gap:10px;
  padding:9px 12px;border-radius:9px;
  cursor:pointer;transition:all .18s;
  font-size:13px;font-weight:600;color:var(--t2);
  border:1px solid transparent;
  background:none;width:100%;text-align:left;font-family:var(--fb);
  position:relative;
}
.sb-item:hover{color:var(--t1);background:rgba(255,255,255,.04)}
.sb-item.active{
  color:var(--neon);
  background:var(--neon2);
  border-color:var(--border-neon);
}
.sb-item.active .sb-dot{background:var(--neon)}
.sb-dot{
  width:6px;height:6px;border-radius:50%;
  background:var(--t3);flex-shrink:0;transition:background .2s;
}
.sb-item.active .sb-dot{background:var(--neon);box-shadow:0 0 6px var(--neon)}
.sb-label{flex:1}
.sb-badge{
  background:var(--red);color:#fff;
  font-size:9px;font-weight:800;padding:2px 6px;border-radius:99px;
  letter-spacing:.3px;min-width:18px;text-align:center;
}
.sb-badge.gold{background:var(--gold);color:#000}

.sb-footer{
  padding:10px;border-top:1px solid var(--border);
}
.sb-user{
  display:flex;align-items:center;gap:10px;padding:10px 12px;
  border-radius:9px;background:var(--bg3);border:1px solid var(--border);
}
.sb-avatar{
  width:30px;height:30px;border-radius:8px;
  background:var(--neon);
  display:flex;align-items:center;justify-content:center;
  font-family:var(--fh);font-size:14px;font-weight:900;color:#000;flex-shrink:0;
}
.sb-user-info{}
.sb-user-name{font-size:12px;font-weight:700;color:var(--t1)}
.sb-user-status{font-size:10px;color:var(--neon);letter-spacing:.3px;display:flex;align-items:center;gap:4px}
.sb-status-dot{width:5px;height:5px;border-radius:50%;background:var(--neon);animation:blink 2s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}

/* â•â•â• MAIN AREA â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.main{margin-left:var(--sidebar);flex:1;display:flex;flex-direction:column;height:100vh;overflow:hidden}

/* â•â•â• TOPBAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.topbar{
  height:var(--topbar);
  background:var(--bg2);border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;
  padding:0 24px;flex-shrink:0;
}
.topbar-left{display:flex;align-items:baseline;gap:14px}
.topbar-title{font-family:var(--fh);font-size:18px;font-weight:900;letter-spacing:1.5px;text-transform:uppercase;color:var(--t1)}
.topbar-date{font-size:13px;color:var(--t2);font-weight:500}
.topbar-right{display:flex;align-items:center;gap:8px}
.tb-live{
  display:flex;align-items:center;gap:6px;padding:5px 12px;border-radius:99px;
  background:var(--neon2);border:1px solid var(--border-neon);
  font-size:11px;font-weight:700;color:var(--neon);letter-spacing:.5px;text-transform:uppercase;
}
.tb-live-dot{width:5px;height:5px;border-radius:50%;background:var(--neon);animation:blink 1.5s infinite}
.tb-btn{
  padding:6px 14px;border-radius:7px;
  background:transparent;border:1px solid var(--border2);
  color:var(--t2);font-size:11px;font-weight:700;letter-spacing:.5px;text-transform:uppercase;
  cursor:pointer;font-family:var(--fh);transition:all .2s;
}
.tb-btn:hover{color:var(--t1);background:rgba(255,255,255,.05)}
.tb-btn.danger:hover{color:var(--red);border-color:rgba(255,59,59,.3);background:var(--red2)}

/* â•â•â• CONTENT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.content{flex:1;overflow-y:auto;padding:22px 24px;scroll-behavior:smooth}
.content::-webkit-scrollbar{width:4px}
.content::-webkit-scrollbar-track{background:transparent}
.content::-webkit-scrollbar-thumb{background:var(--bg5);border-radius:2px}

.tab-panel{display:none;animation:fadeIn .25s ease}
.tab-panel.active{display:block}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}

/* â•â•â• KPI CARDS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.kpi-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:20px}
.kpi-card{
  padding:18px 20px;border-radius:12px;
  background:var(--bg3);border:1px solid var(--border);
  position:relative;overflow:hidden;
  transition:border-color .2s;
}
.kpi-card::after{
  content:'';position:absolute;bottom:0;left:0;right:0;height:2px;
  background:var(--kpi-color,var(--neon));opacity:.4;
}
.kpi-card:hover{border-color:var(--border2)}
.kpi-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px}
.kpi-label{
  font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--t2);
}
.kpi-ico{font-size:16px;opacity:.7}
.kpi-val{
  font-family:var(--fh);font-size:42px;font-weight:900;line-height:1;
  color:var(--kpi-color,var(--neon));
  text-shadow:0 0 20px var(--kpi-color,rgba(57,255,20,.4));
  margin-bottom:4px;
}
.kpi-sub{font-size:11px;color:var(--t3);letter-spacing:.3px}

/* â•â•â• SECTION HEADER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sec-hd{
  display:flex;align-items:center;justify-content:space-between;
  margin-bottom:14px;flex-wrap:wrap;gap:8px;
}
.sec-title{
  font-family:var(--fh);font-size:14px;font-weight:800;letter-spacing:2px;
  text-transform:uppercase;color:var(--t2);
}
.sec-actions{display:flex;gap:6px;align-items:center}

/* â•â•â• CALENDAR STRIP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.cal-strip{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;margin-bottom:20px}
.cal-day{
  display:flex;flex-direction:column;align-items:center;gap:4px;
  padding:10px 6px;border-radius:10px;
  border:1px solid var(--border);background:var(--bg3);
  cursor:pointer;transition:all .2s;font-family:var(--fb);
}
.cal-day:hover:not(.past){border-color:var(--border-neon);background:var(--neon2)}
.cal-day.active{
  border-color:var(--neon);background:var(--neon);
  box-shadow:var(--neon-glow);
}
.cal-day.past{opacity:.35;cursor:not-allowed}
.cal-day-name{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:1px;
  color:currentColor;opacity:.65}
.cal-day-num{font-family:var(--fh);font-size:22px;font-weight:900;line-height:1;color:currentColor}
.cal-day.active .cal-day-name,.cal-day.active .cal-day-num{color:#000}
.cal-dots{display:flex;gap:3px;min-height:6px}
.cdot{width:5px;height:5px;border-radius:50%}
.cdot-r{background:var(--red)}.cdot-y{background:var(--gold)}.cdot-g{background:var(--neon)}

/* â•â•â• CRONOGRAMA â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.cronograma-wrap{
  background:var(--bg3);border:1px solid var(--border);border-radius:12px;overflow:hidden;
}
.cronograma-head{
  padding:14px 20px;border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;
}
.cronograma-title{font-family:var(--fh);font-size:15px;font-weight:800;letter-spacing:1px;text-transform:uppercase}
.cronograma-meta{font-size:12px;color:var(--t2)}
.crono-row{
  display:grid;grid-template-columns:64px 1fr auto;align-items:center;
  padding:10px 20px;border-bottom:1px solid rgba(255,255,255,.03);
  gap:16px;transition:background .15s;
}
.crono-row:last-child{border-bottom:none}
.crono-row:hover{background:rgba(255,255,255,.02)}
.crono-hora{
  font-family:var(--fh);font-size:16px;font-weight:800;letter-spacing:.5px;color:var(--t2);
}
.crono-info{display:flex;flex-direction:column;gap:2px}
.crono-cliente{font-size:13px;font-weight:600;color:var(--t1)}
.crono-detail{font-size:11px;color:var(--t3)}
.crono-status{display:flex;align-items:center;gap:8px}

/* â•â•â• STATUS CHIPS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.chip{
  display:inline-flex;align-items:center;gap:4px;
  padding:3px 10px;border-radius:99px;
  font-size:10px;font-weight:800;letter-spacing:.8px;text-transform:uppercase;
  border:1px solid;
}
.chip-libre{background:var(--neon2);border-color:var(--neon3);color:var(--neon)}
.chip-pendiente{background:var(--gold2);border-color:rgba(255,184,0,.3);color:var(--gold)}
.chip-confirmado{background:rgba(57,255,20,.08);border-color:var(--neon3);color:var(--neon)}
.chip-bloqueado{background:rgba(255,255,255,.05);border-color:var(--border2);color:var(--t2)}
.chip-fijo{background:var(--blue2);border-color:rgba(59,158,255,.3);color:var(--blue)}
.chip-cancelado{background:var(--red2);border-color:rgba(255,59,59,.3);color:var(--red)}

/* â•â•â• BUTTONS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.btn{
  display:inline-flex;align-items:center;gap:6px;
  padding:7px 14px;border-radius:7px;
  font-family:var(--fh);font-size:12px;font-weight:800;letter-spacing:1px;text-transform:uppercase;
  cursor:pointer;border:1px solid;transition:all .2s;
}
.btn-neon{background:var(--neon);border-color:var(--neon);color:#000}
.btn-neon:hover{box-shadow:var(--neon-glow);transform:translateY(-1px)}
.btn-outline{background:transparent;border-color:var(--border2);color:var(--t2)}
.btn-outline:hover{background:rgba(255,255,255,.04);color:var(--t1)}
.btn-gold{background:var(--gold);border-color:var(--gold);color:#000}
.btn-gold:hover{box-shadow:0 0 16px rgba(255,184,0,.4)}
.btn-red{background:transparent;border-color:rgba(255,59,59,.4);color:var(--red)}
.btn-red:hover{background:var(--red2)}
.btn-approve{background:var(--neon2);border-color:var(--neon3);color:var(--neon)}
.btn-approve:hover{background:rgba(57,255,20,.18)}
.btn-cancel-act{background:var(--red2);border-color:rgba(255,59,59,.3);color:var(--red)}
.btn-cancel-act:hover{background:rgba(255,59,59,.2)}
.btn-free{background:var(--gold2);border-color:var(--gold3,rgba(255,184,0,.3));color:var(--gold)}
.btn-free:hover{background:rgba(255,184,0,.2)}
.btn-edit{background:var(--blue2);border-color:rgba(59,158,255,.3);color:var(--blue)}
.btn-edit:hover{background:rgba(59,158,255,.2)}

.btn-sm{padding:4px 10px;font-size:10px}

/* â•â•â• TABLE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.t-wrap{background:var(--bg3);border:1px solid var(--border);border-radius:12px;overflow:hidden}
table{width:100%;border-collapse:collapse}
th{
  padding:10px 16px;font-family:var(--fh);font-size:10px;font-weight:800;
  letter-spacing:2px;text-transform:uppercase;color:var(--t3);
  border-bottom:1px solid var(--border);text-align:left;
}
td{padding:12px 16px;font-size:13px;color:var(--t2);border-bottom:1px solid rgba(255,255,255,.03)}
tr:last-child td{border-bottom:none}
tr:hover td{background:rgba(255,255,255,.015)}
td strong{color:var(--t1);font-weight:600}
.td-mono{font-family:var(--fh);font-size:15px;font-weight:800}

/* â•â•â• FILTER BAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.filter-bar{display:flex;gap:6px;flex-wrap:wrap}
.filter-pill{
  padding:5px 12px;border-radius:99px;
  border:1px solid var(--border);background:transparent;
  color:var(--t3);font-size:11px;font-weight:700;letter-spacing:.5px;text-transform:uppercase;
  cursor:pointer;font-family:var(--fh);transition:all .2s;
}
.filter-pill:hover{color:var(--t2);border-color:var(--border2)}
.filter-pill.active{
  background:var(--neon2);border-color:var(--border-neon);color:var(--neon);
}

/* â•â•â• FIJOS CARDS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.fijos-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px}
.fijo-card{
  padding:16px 18px;border-radius:12px;
  background:var(--bg3);border:1px solid var(--border);
  transition:border-color .2s;
}
.fijo-card:hover{border-color:var(--border2)}
.fc-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px}
.fc-name{font-size:14px;font-weight:700;color:var(--t1);margin-bottom:3px}
.fc-tel{font-size:11px;color:var(--t3)}
.fc-schedule{
  display:flex;align-items:center;gap:8px;flex-wrap:wrap;
  padding:10px 12px;border-radius:8px;background:var(--bg4);
  border:1px solid var(--border);margin-bottom:12px;
}
.fc-dia{font-family:var(--fh);font-size:14px;font-weight:800;letter-spacing:.5px;color:var(--neon)}
.fc-sep{color:var(--t3)}
.fc-hora{font-family:var(--fh);font-size:14px;font-weight:700;color:var(--t1)}
.fc-persons{font-size:11px;color:var(--t3)}
.fc-desde{font-size:11px;color:var(--t3);margin-bottom:10px}
.fc-actions{display:flex;gap:6px}

/* â•â•â• SOLICITUDES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.solicitud-item{
  padding:14px 18px;border-radius:10px;margin-bottom:8px;
  background:rgba(255,184,0,.04);
  border:1px solid rgba(255,184,0,.15);
  transition:border-color .2s;
}
.solicitud-item:hover{border-color:rgba(255,184,0,.3)}
.sol-row1{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
.sol-name{font-size:14px;font-weight:700;color:var(--t1)}
.sol-time{font-size:11px;color:var(--t3)}
.sol-details{font-size:12px;color:var(--t2);margin-bottom:10px;line-height:1.5}
.sol-actions{display:flex;gap:6px}

/* â•â•â• FINANZAS CHARTS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.fin-2col{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:14px}
.chart-card{background:var(--bg3);border:1px solid var(--border);border-radius:12px;padding:18px 20px}
.chart-title{font-family:var(--fh);font-size:11px;font-weight:800;letter-spacing:2px;text-transform:uppercase;color:var(--t2);margin-bottom:14px}

.bar-row{display:flex;align-items:center;gap:10px;margin-bottom:8px}
.bar-lbl{font-size:11px;color:var(--t2);width:72px;text-align:right;flex-shrink:0;font-weight:600}
.bar-track{flex:1;height:18px;background:rgba(255,255,255,.04);border-radius:3px;overflow:hidden;border:1px solid var(--border)}
.bar-fill{height:100%;border-radius:3px;transition:width 1s cubic-bezier(.23,1,.32,1)}
.bar-fill.g{background:linear-gradient(90deg,rgba(57,255,20,.3),var(--neon))}
.bar-fill.y{background:linear-gradient(90deg,rgba(255,184,0,.3),var(--gold))}
.bar-fill.b{background:linear-gradient(90deg,rgba(59,158,255,.3),var(--blue))}
.bar-fill.r{background:linear-gradient(90deg,rgba(255,59,59,.3),var(--red))}
.bar-val{font-family:var(--fh);font-size:12px;font-weight:800;color:var(--t1);width:52px;flex-shrink:0}

/* Tienda */
.product-item{
  display:flex;align-items:center;gap:12px;padding:11px 14px;
  border-radius:9px;background:var(--bg4);border:1px solid var(--border);
  margin-bottom:6px;cursor:pointer;transition:all .2s;
}
.product-item:hover{border-color:var(--border-neon);background:rgba(57,255,20,.04)}
.prod-icon{font-size:22px;width:38px;height:38px;display:flex;align-items:center;justify-content:center;
  background:var(--bg3);border-radius:8px;border:1px solid var(--border);flex-shrink:0}
.prod-name{font-size:13px;font-weight:600;color:var(--t1)}
.prod-price{font-size:11px;color:var(--t3)}
.prod-right{margin-left:auto;display:flex;align-items:center;gap:12px}
.prod-sold{font-size:11px;color:var(--t2)}
.prod-total{font-family:var(--fh);font-size:14px;font-weight:800;color:var(--neon)}

.add-prod-btn{
  display:flex;align-items:center;justify-content:center;gap:6px;
  padding:11px;border-radius:9px;border:1.5px dashed var(--border2);
  font-family:var(--fh);font-size:11px;font-weight:800;letter-spacing:1px;text-transform:uppercase;
  color:var(--t3);cursor:pointer;transition:all .2s;margin-top:6px;background:none;width:100%;
}
.add-prod-btn:hover{border-color:var(--border-neon);color:var(--neon);background:var(--neon2)}

/* â•â•â• CONFIG SECTION â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.price-row{
  display:grid;grid-template-columns:120px 1fr repeat(2,120px);align-items:center;
  padding:12px 16px;border-bottom:1px solid rgba(255,255,255,.03);gap:12px;
}
.price-row:last-child{border-bottom:none}
.price-row:hover{background:rgba(255,255,255,.02)}
.price-label{font-family:var(--fh);font-size:13px;font-weight:800;letter-spacing:.5px;color:var(--t1)}
.price-range{font-size:11px;color:var(--t3)}
.price-edit{
  background:var(--bg4);border:1px solid var(--border2);border-radius:7px;
  color:var(--neon);font-family:var(--fh);font-size:16px;font-weight:900;
  padding:7px 10px;width:100%;outline:none;text-align:right;
  transition:all .2s;
}
.price-edit:focus{border-color:var(--border-neon);box-shadow:0 0 0 2px rgba(57,255,20,.1)}

.horario-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:10px}
.horario-item{
  padding:14px 16px;border-radius:10px;
  background:var(--bg3);border:1px solid var(--border);
}
.horario-dia{font-family:var(--fh);font-size:13px;font-weight:800;letter-spacing:.5px;color:var(--t1);
  margin-bottom:10px;display:flex;justify-content:space-between;align-items:center}
.horario-times{display:flex;gap:6px;align-items:center}
.time-input{
  background:var(--bg4);border:1px solid var(--border2);border-radius:6px;
  color:var(--t1);font-size:12px;padding:6px 8px;width:75px;outline:none;font-family:var(--fb);
  transition:border-color .2s;
}
.time-input:focus{border-color:var(--border-neon)}
.toggle-switch{position:relative;width:32px;height:18px;flex-shrink:0;cursor:pointer}
.toggle-switch input{opacity:0;width:0;height:0;position:absolute}
.toggle-slider{
  position:absolute;inset:0;border-radius:99px;
  background:var(--bg5);border:1px solid var(--border2);transition:all .25s;
}
.toggle-slider::before{
  content:'';position:absolute;width:12px;height:12px;border-radius:50%;
  top:2px;left:2px;background:var(--t3);transition:all .25s;
}
.toggle-switch input:checked + .toggle-slider{background:var(--neon);border-color:var(--neon)}
.toggle-switch input:checked + .toggle-slider::before{transform:translateX(14px);background:#000}

/* â•â•â• MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.overlay{
  position:fixed;inset:0;background:rgba(0,0,0,.85);backdrop-filter:blur(8px);
  z-index:500;display:flex;align-items:center;justify-content:center;padding:20px;
  opacity:0;pointer-events:none;transition:opacity .25s;
}
.overlay.open{opacity:1;pointer-events:all}
.modal{
  background:var(--bg3);border:1px solid var(--border2);border-radius:16px;
  width:100%;max-width:460px;padding:28px;position:relative;
  transform:translateY(16px) scale(.98);transition:all .3s cubic-bezier(.23,1,.32,1);
  box-shadow:0 40px 80px rgba(0,0,0,.8);max-height:90vh;overflow-y:auto;
}
.modal::before{
  content:'';position:absolute;top:-1px;left:15%;right:15%;height:1px;
  background:linear-gradient(90deg,transparent,var(--neon),transparent);
}
.overlay.open .modal{transform:none}
.m-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
.m-title{font-family:var(--fh);font-size:20px;font-weight:900;letter-spacing:1px;text-transform:uppercase}
.m-x{
  width:28px;height:28px;border-radius:6px;
  border:1px solid var(--border2);background:var(--bg4);color:var(--t2);
  cursor:pointer;font-size:14px;display:flex;align-items:center;justify-content:center;
  transition:all .18s;
}
.m-x:hover{background:var(--red2);color:var(--red);border-color:rgba(255,59,59,.3)}

.form-group{margin-bottom:14px}
.form-label{
  display:block;font-family:var(--fh);font-size:10px;font-weight:800;
  letter-spacing:1.5px;text-transform:uppercase;color:var(--t2);margin-bottom:6px;
}
.form-input,.form-select,.form-textarea{
  width:100%;padding:10px 12px;border-radius:8px;
  background:var(--bg4);border:1px solid var(--border2);
  color:var(--t1);font-size:13px;font-family:var(--fb);outline:none;
  transition:all .18s;
}
.form-input:focus,.form-select:focus,.form-textarea:focus{
  border-color:var(--border-neon);box-shadow:0 0 0 2px rgba(57,255,20,.08);
}
.form-select option{background:var(--bg3)}
.form-textarea{resize:vertical;min-height:70px}
.form-2col{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.m-btns{display:flex;gap:8px;margin-top:20px}
.m-cancel-btn{flex:1;padding:10px;border-radius:8px;border:1px solid var(--border2);
  background:transparent;color:var(--t2);font-family:var(--fh);font-size:12px;font-weight:800;
  letter-spacing:1px;text-transform:uppercase;cursor:pointer;transition:all .2s}
.m-cancel-btn:hover{background:rgba(255,255,255,.04);color:var(--t1)}
.m-save-btn{flex:2;padding:10px;border-radius:8px;border:none;
  background:var(--neon);color:#000;font-family:var(--fh);font-size:12px;font-weight:900;
  letter-spacing:1px;text-transform:uppercase;cursor:pointer;transition:all .25s}
.m-save-btn:hover{box-shadow:var(--neon-glow)}
.m-save-btn.gold{background:var(--gold)}
.m-save-btn.red{background:var(--red)}

.res-box{
  background:var(--bg4);border:1px solid var(--border);border-radius:10px;
  padding:14px 16px;margin-bottom:16px;
  display:grid;grid-template-columns:1fr 1fr;gap:10px 16px;
}
.rb-key{font-size:9px;font-weight:800;letter-spacing:1.5px;text-transform:uppercase;color:var(--t3);margin-bottom:3px}
.rb-val{font-size:14px;font-weight:600;color:var(--t1)}
.rb-val.neon{font-family:var(--fh);font-size:20px;font-weight:900;color:var(--neon)}

.upload-area{
  border:1.5px dashed var(--border2);border-radius:10px;padding:20px;
  text-align:center;cursor:pointer;transition:all .2s;margin-bottom:16px;
}
.upload-area:hover{border-color:var(--border-neon);background:var(--neon2)}
.upload-area .upload-ico{font-size:26px;margin-bottom:6px}
.upload-area p{font-size:12px;color:var(--t2);line-height:1.5}

/* â•â•â• TOAST â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.toast{
  position:fixed;bottom:20px;right:20px;z-index:9999;
  padding:12px 18px;border-radius:10px;
  background:var(--bg3);border:1px solid var(--border-neon);
  color:var(--neon);font-size:13px;font-weight:600;
  display:flex;align-items:center;gap:8px;
  box-shadow:0 4px 30px rgba(0,0,0,.6), 0 0 16px rgba(57,255,20,.15);
  transform:translateY(60px);opacity:0;pointer-events:none;
  transition:all .35s cubic-bezier(.23,1,.32,1);
}
.toast.show{transform:translateY(0);opacity:1}

/* â•â•â• STATS SECTION â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.stats-2col{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:14px}

/* Movimientos table color */
.mv-cat-cancha{font-family:var(--fh);font-size:10px;font-weight:800;letter-spacing:.5px;
  padding:2px 8px;border-radius:99px;background:var(--neon2);color:var(--neon);border:1px solid var(--neon3)}
.mv-cat-tienda{font-family:var(--fh);font-size:10px;font-weight:800;letter-spacing:.5px;
  padding:2px 8px;border-radius:99px;background:var(--blue2);color:var(--blue);border:1px solid rgba(59,158,255,.3)}

/* Scrollbar for modal */
.modal::-webkit-scrollbar{width:3px}
.modal::-webkit-scrollbar-thumb{background:var(--bg5);border-radius:2px}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     LOGIN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="login-screen">
  <div class="login-box">
    <div class="login-eyebrow">Panel de Control</div>
    <div class="login-title">Administrador</div>
    <div class="pin-display" id="pin-display">
      <div class="pin-dot" id="pd0"></div>
      <div class="pin-dot" id="pd1"></div>
      <div class="pin-dot" id="pd2"></div>
      <div class="pin-dot" id="pd3"></div>
    </div>
    <input class="pin-input" type="password" id="pin-input" maxlength="4" placeholder="Â· Â· Â· Â·"
      oninput="onPinInput(this)" onkeydown="if(event.key==='Enter')tryLogin()"/>
    <button class="login-btn" onclick="tryLogin()">Ingresar â†’</button>
    <div class="login-error" id="login-error"></div>
    <div class="login-hint">PIN DEMO: 1234</div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     APP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="app">

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="sb-brand">
    <div class="sb-logo-mark"><span>AMN</span></div>
    <div class="sb-brand-text">
      <div class="sb-brand-name">AMN.</div>
      <div class="sb-brand-sub">Panel Admin</div>
    </div>
  </div>
  <div class="sb-nav">
    <div class="sb-section">Principal</div>
    <button class="sb-item active" onclick="nav('agenda',this)">
      <span class="sb-dot"></span><span class="sb-label">Agenda del dÃ­a</span>
    </button>
    <button class="sb-item" onclick="nav('estadisticas',this)">
      <span class="sb-dot"></span><span class="sb-label">EstadÃ­sticas</span>
    </button>
    <button class="sb-item" onclick="nav('historial',this)">
      <span class="sb-dot"></span><span class="sb-label">Historial</span>
    </button>

    <div class="sb-section">GestiÃ³n</div>
    <button class="sb-item" onclick="nav('reservas',this)">
      <span class="sb-dot"></span><span class="sb-label">Reservas</span>
      <span class="sb-badge" id="badge-res">3</span>
    </button>
    <button class="sb-item" onclick="nav('fijos',this)">
      <span class="sb-dot"></span><span class="sb-label">Clientes Fijos</span>
      <span class="sb-badge gold" id="badge-fijos">2</span>
    </button>
    <button class="sb-item" onclick="nav('eventos',this)">
      <span class="sb-dot"></span><span class="sb-label">Eventos</span>
    </button>
    <button class="sb-item" onclick="nav('finanzas',this)">
      <span class="sb-dot"></span><span class="sb-label">Finanzas</span>
    </button>

    <div class="sb-section">ConfiguraciÃ³n</div>
    <button class="sb-item" onclick="nav('cancha',this)">
      <span class="sb-dot"></span><span class="sb-label">Cancha</span>
    </button>
    <button class="sb-item" onclick="nav('pagos',this)">
      <span class="sb-dot"></span><span class="sb-label">Datos de pago</span>
    </button>
    <button class="sb-item" onclick="nav('horarios',this)">
      <span class="sb-dot"></span><span class="sb-label">Horarios</span>
    </button>
  </div>
  <div class="sb-footer">
    <div class="sb-user">
      <div class="sb-avatar">A</div>
      <div class="sb-user-info">
        <div class="sb-user-name">Administrador</div>
        <div class="sb-user-status"><span class="sb-status-dot"></span>ACTIVO</div>
      </div>
    </div>
  </div>
</aside>

<!-- MAIN -->
<div class="main">
  <div class="topbar">
    <div class="topbar-left">
      <div class="topbar-title" id="topbar-title">Agenda Diaria</div>
      <div class="topbar-date" id="topbar-date"></div>
    </div>
    <div class="topbar-right">
      <div class="tb-live"><span class="tb-live-dot"></span>EN VIVO</div>
      <a href="cancha16-cliente.html" target="_blank" class="tb-btn">ğŸ‘ Ver sitio</a>
      <button class="tb-btn danger" onclick="logout()">SALIR</button>
    </div>
  </div>

  <div class="content">

    <!-- â•â• AGENDA DEL DÃA â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-panel active" id="tab-agenda">
      <!-- KPIs -->
      <div class="kpi-grid">
        <div class="kpi-card" style="--kpi-color:var(--neon)">
          <div class="kpi-top"><span class="kpi-label">Total Hoy</span><span class="kpi-ico">ğŸ“…</span></div>
          <div class="kpi-val" id="kpi-total">9</div>
          <div class="kpi-sub">reservas registradas</div>
        </div>
        <div class="kpi-card" style="--kpi-color:var(--gold)">
          <div class="kpi-top"><span class="kpi-label">Pendientes</span><span class="kpi-ico">â³</span></div>
          <div class="kpi-val" id="kpi-pend">3</div>
          <div class="kpi-sub">esperando confirmaciÃ³n</div>
        </div>
        <div class="kpi-card" style="--kpi-color:var(--neon)">
          <div class="kpi-top"><span class="kpi-label">Confirmados</span><span class="kpi-ico">âœ…</span></div>
          <div class="kpi-val" id="kpi-conf">5</div>
          <div class="kpi-sub">pagos validados</div>
        </div>
        <div class="kpi-card" style="--kpi-color:var(--gray)">
          <div class="kpi-top"><span class="kpi-label">Bloqueados</span><span class="kpi-ico">ğŸ”’</span></div>
          <div class="kpi-val" id="kpi-bloq" style="color:var(--gray)">1</div>
          <div class="kpi-sub">mantenimiento / propio</div>
        </div>
      </div>

      <!-- Selector dÃ­as -->
      <div class="sec-hd" style="margin-bottom:10px">
        <span class="sec-title">Selecciona el dÃ­a</span>
      </div>
      <div class="cal-strip" id="cal-strip"></div>

      <!-- Cronograma -->
      <div class="sec-hd">
        <span class="sec-title">Cronograma del dÃ­a</span>
        <div class="sec-actions">
          <button class="btn btn-neon btn-sm" onclick="openNuevaReserva()">+ Nueva reserva</button>
          <button class="btn btn-outline btn-sm" onclick="openBloqueo()">ğŸ”’ Bloquear hora</button>
        </div>
      </div>
      <div class="cronograma-wrap">
        <div class="cronograma-head">
          <div class="cronograma-title" id="crono-title">MiÃ©rcoles 25 de Febrero</div>
          <div class="cronograma-meta" id="crono-meta"></div>
        </div>
        <div id="cronograma-body"></div>
      </div>
    </div>

    <!-- â•â• ESTADÃSTICAS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-panel" id="tab-estadisticas">
      <div class="kpi-grid" id="stat-kpis" style="grid-template-columns:repeat(4,1fr);margin-bottom:20px">
        <div class="kpi-card"><div class="kpi-top"><span class="kpi-label">Ingresos Mes</span></div><div class="kpi-val" style="color:var(--t3)">â€”</div></div>
        <div class="kpi-card"><div class="kpi-top"><span class="kpi-label">Reservas Mes</span></div><div class="kpi-val" style="color:var(--t3)">â€”</div></div>
        <div class="kpi-card"><div class="kpi-top"><span class="kpi-label">OcupaciÃ³n</span></div><div class="kpi-val" style="color:var(--t3)">â€”</div></div>
        <div class="kpi-card"><div class="kpi-top"><span class="kpi-label">Clientes Fijos</span></div><div class="kpi-val" style="color:var(--t3)">â€”</div></div>
      </div>
      <div class="fin-2col">
        <div class="chart-card">
          <div class="chart-title">Ingresos por dÃ­a (esta semana)</div>
          <div id="stat-dias-chart"></div>
        </div>
        <div class="chart-card">
          <div class="chart-title">Reservas por franja horaria</div>
          <div id="stat-franja-chart"></div>
        </div>
      </div>
      <div class="fin-2col">
        <div class="chart-card">
          <div class="chart-title">DÃ­as mÃ¡s populares</div>
          <div id="stat-popularidad-chart"></div>
        </div>
        <div class="chart-card">
          <div class="chart-title">Estado de reservas (mes)</div>
          <div id="stat-estado-chart"></div>
        </div>
      </div>
    </div>

    <!-- â•â• HISTORIAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-panel" id="tab-historial">
      <div class="sec-hd">
        <span class="sec-title">Historial de Reservas</span>
        <div class="sec-actions">
          <div class="filter-bar" id="hist-filters">
            <button class="filter-pill active" onclick="filterHist(this,'all')">Todas</button>
            <button class="filter-pill" onclick="filterHist(this,'confirmado')">Confirmadas</button>
            <button class="filter-pill" onclick="filterHist(this,'pendiente')">Pendientes</button>
            <button class="filter-pill" onclick="filterHist(this,'cancelado')">Canceladas</button>
            <button class="filter-pill" onclick="filterHist(this,'fijo')">Fijos</button>
          </div>
        </div>
      </div>
      <div class="t-wrap">
        <table>
          <thead><tr><th>Cliente</th><th>Fecha</th><th>Horario</th><th>Precio</th><th>Abono</th><th>Saldo</th><th>Tipo</th><th>Estado</th><th>Acciones</th></tr></thead>
          <tbody id="hist-tbody"></tbody>
        </table>
      </div>
    </div>

    <!-- â•â• RESERVAS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-panel" id="tab-reservas">
      <div class="sec-hd">
        <span class="sec-title">GestiÃ³n de Reservas</span>
        <div class="sec-actions">
          <button class="btn btn-neon btn-sm" onclick="openNuevaReserva()">+ Nueva</button>
        </div>
      </div>
      <div class="t-wrap">
        <table>
          <thead><tr><th>Cliente</th><th>Fecha</th><th>Horario</th><th>Precio</th><th>Abono</th><th>Saldo</th><th>Tipo</th><th>Estado</th><th>Acciones</th></tr></thead>
          <tbody id="res-tbody"></tbody>
        </table>
      </div>
    </div>

    <!-- â•â• CLIENTES FIJOS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-panel" id="tab-fijos">
      <div class="sec-hd">
        <span class="sec-title">Clientes Fijos</span>
        <div class="sec-actions">
          <button class="btn btn-neon btn-sm" onclick="openNuevoFijo()">+ Registrar manual</button>
        </div>
      </div>
      <div id="solicitudes-section"></div>
      <div class="sec-hd" style="margin-top:20px">
        <span class="sec-title" style="font-size:11px">Cupos activos</span>
      </div>
      <div class="fijos-grid" id="fijos-grid"></div>
    </div>

    <!-- â•â• EVENTOS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-panel" id="tab-eventos">
      <div class="sec-hd">
        <span class="sec-title">GestiÃ³n de Eventos</span>
        <div class="sec-actions">
          <button class="btn btn-gold btn-sm" onclick="openNuevoEvento()">+ Crear evento</button>
        </div>
      </div>
      <div class="t-wrap">
        <table>
          <thead><tr><th>Evento</th><th>Tipo</th><th>Fecha</th><th>Precio</th><th>Cupos</th><th>Estado</th><th>Acciones</th></tr></thead>
          <tbody id="ev-tbody"></tbody>
        </table>
      </div>
    </div>

    <!-- â•â• FINANZAS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-panel" id="tab-finanzas">
      <div class="kpi-grid" id="fin-kpis" style="margin-bottom:16px">
        <div class="kpi-card"><div class="kpi-top"><span class="kpi-label">Total Mes</span></div><div class="kpi-val" style="color:var(--t3)">â€”</div></div>
        <div class="kpi-card"><div class="kpi-top"><span class="kpi-label">Cancha</span></div><div class="kpi-val" style="color:var(--t3)">â€”</div></div>
        <div class="kpi-card"><div class="kpi-top"><span class="kpi-label">Tienda</span></div><div class="kpi-val" style="color:var(--t3)">â€”</div></div>
        <div class="kpi-card"><div class="kpi-top"><span class="kpi-label">Promedio/dÃ­a</span></div><div class="kpi-val" style="color:var(--t3)">â€”</div></div>
      </div>
      <div class="fin-2col">
        <div class="chart-card"><div class="chart-title">Ingresos por dÃ­a</div><div id="fin-dias"></div></div>
        <div class="chart-card"><div class="chart-title">Ingresos por franja</div><div id="fin-franjas"></div></div>
      </div>
      <div class="sec-hd">
        <span class="sec-title">Tienda Â· Productos</span>
        <div class="sec-actions"><button class="btn btn-neon btn-sm" onclick="openAddProduct()">+ Producto</button></div>
      </div>
      <div class="t-wrap" style="padding:14px">
        <div id="tienda-list"></div>
        <button class="add-prod-btn" onclick="openAddProduct()">+ Agregar producto o bebida</button>
      </div>
      <div class="sec-hd" style="margin-top:16px"><span class="sec-title">Movimientos recientes</span></div>
      <div class="t-wrap">
        <table>
          <thead><tr><th>DescripciÃ³n</th><th>CategorÃ­a</th><th>Hora</th><th>Monto</th></tr></thead>
          <tbody id="movs-tbody"></tbody>
        </table>
      </div>
    </div>

    <!-- â•â• CANCHA CONFIG â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-panel" id="tab-cancha">
      <div class="sec-hd">
        <span class="sec-title">InformaciÃ³n de la Cancha</span>
        <div class="sec-actions"><button class="btn btn-neon btn-sm" onclick="saveConfig()">ğŸ’¾ Guardar</button></div>
      </div>
      <div class="t-wrap" style="padding:20px;margin-bottom:16px">
        <div class="form-2col">
          <div class="form-group"><label class="form-label">Nombre</label><input class="form-input" value="Cancha de la 16"/></div>
          <div class="form-group"><label class="form-label">WhatsApp</label><input class="form-input" value="+57 300 123 4567"/></div>
          <div class="form-group"><label class="form-label">DirecciÃ³n</label><input class="form-input" value="Calle 16 #45-10, MedellÃ­n"/></div>
          <div class="form-group"><label class="form-label">Capacidad mÃ¡x.</label><input class="form-input" type="number" value="12"/></div>
        </div>
        <!-- Abono mÃ­nimo -->
        <div style="margin-top:16px;padding-top:16px;border-top:1px solid var(--border)">
          <div style="font-family:var(--fh);font-size:11px;font-weight:800;letter-spacing:2px;text-transform:uppercase;color:var(--t2);margin-bottom:12px">
            âš¡ ConfiguraciÃ³n de Abonos
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;align-items:end">
            <div class="form-group" style="margin-bottom:0">
              <label class="form-label">Monto mÃ­nimo de abono (COP)</label>
              <input class="form-input" type="number" id="cfg-abono" value="20000"
                style="font-family:var(--fh);font-size:20px;font-weight:900;color:var(--gold)"
                onchange="updateAbonoMinimo(+this.value)"/>
              <div style="font-size:11px;color:var(--t3);margin-top:4px">El cliente puede reservar pagando solo este monto ahora</div>
            </div>
            <div style="padding:14px 16px;border-radius:10px;background:var(--gold2);border:1px solid var(--gold3)">
              <div style="font-size:10px;font-weight:700;color:var(--gold);letter-spacing:1px;text-transform:uppercase;margin-bottom:4px">Ejemplo</div>
              <div style="font-family:var(--fh);font-size:13px;color:var(--t2)">
                Hora $80.000 â†’ abona <strong id="cfg-abono-preview" style="color:var(--gold)">$20.000</strong><br>
                Paga en cancha: <strong id="cfg-resto-preview" style="color:var(--red)">$60.000</strong>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="sec-hd"><span class="sec-title">Precios por Franja</span></div>
      <div class="t-wrap" style="margin-bottom:16px">
        <div id="franjas-config"></div>
      </div>
    </div>

    <!-- â•â• DATOS DE PAGO â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-panel" id="tab-pagos">
      <div class="sec-hd">
        <span class="sec-title">Datos de Pago</span>
        <div class="sec-actions"><button class="btn btn-neon btn-sm" onclick="saveConfig()">ğŸ’¾ Guardar</button></div>
      </div>
      <div class="t-wrap" style="padding:20px">
        <div class="form-group"><label class="form-label">Banco / Entidad</label><input class="form-input" value="Bancolombia"/></div>
        <div class="form-group"><label class="form-label">NÃºmero de cuenta</label><input class="form-input" value="123-456789-00"/></div>
        <div class="form-2col">
          <div class="form-group"><label class="form-label">Nequi</label><input class="form-input" value="+57 300 123 4567"/></div>
          <div class="form-group"><label class="form-label">Daviplata</label><input class="form-input" value="+57 300 123 4567"/></div>
        </div>
        <div class="form-group"><label class="form-label">Titular de la cuenta</label><input class="form-input" value="Cancha de la 16 S.A.S."/></div>
        <div class="form-group"><label class="form-label">Instrucciones para el cliente</label>
          <textarea class="form-textarea">Realiza la transferencia y sube el comprobante. Tu reserva serÃ¡ confirmada en mÃ¡ximo 1 hora.</textarea>
        </div>
      </div>
    </div>

    <!-- â•â• HORARIOS CONFIG â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-panel" id="tab-horarios">
      <div class="sec-hd">
        <span class="sec-title">Horarios Operativos</span>
        <div class="sec-actions"><button class="btn btn-neon btn-sm" onclick="saveConfig()">ğŸ’¾ Guardar</button></div>
      </div>
      <div class="horario-grid" id="horario-grid"></div>
      <div class="sec-hd" style="margin-top:20px">
        <span class="sec-title">Multiplicadores de Precio</span>
        <div class="sec-actions"><button class="btn btn-outline btn-sm" onclick="openNuevoMultiplicador()">+ Agregar</button></div>
      </div>
      <div id="multiplicadores-list"></div>
    </div>

  </div><!-- /content -->
</div><!-- /main -->
</div><!-- /app -->

<!-- â•â•â• MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="overlay" id="ov" onclick="if(event.target.id==='ov')closeModal()">
  <div class="modal" id="modal-body"></div>
</div>

<!-- â•â•â• TOAST â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="toast" id="toast"><span id="t-ico">âœ…</span><span id="t-msg">OK</span></div>

<!-- ENV -->
<script>
window.ENV = {
  SUPABASE_URL:      'https://laoipuyrbqhnkcredtag.supabase.co',
  SUPABASE_ANON_KEY: 'sb_publishable_jh2DtwMpGx7wOgmAuD378A_iK2Z9MTt',
  ADMIN_PIN:         '1234',
}
</script>
<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm'

// â”€â”€ Supabase â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const sb = createClient(window.ENV.SUPABASE_URL, window.ENV.SUPABASE_ANON_KEY)

// â”€â”€ Constantes â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const DIAS_ES   = ['Dom','Lun','Mar','MiÃ©','Jue','Vie','SÃ¡b']
const DIAS_FULL = ['Domingo','Lunes','Martes','MiÃ©rcoles','Jueves','Viernes','SÃ¡bado']
const MESES_ES  = ['enero','febrero','marzo','abril','mayo','junio','julio','agosto','septiembre','octubre','noviembre','diciembre']

// â”€â”€ Estado en memoria â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let selDate    = new Date()
let selDayIdx  = 0
let franjasConf= []
let horarioOp  = []
let multiplicadores = []
let channelAdmin = null

// â•â•â• LOGIN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.onPinInput = function(el) {
  const v = el.value.replace(/\D/g,'')
  el.value = v
  for (let i=0;i<4;i++) document.getElementById('pd'+i).classList.toggle('filled', i<v.length)
}

window.tryLogin = async function() {
  const pin = document.getElementById('pin-input').value
  const err = document.getElementById('login-error')

  // Verificar PIN (en producciÃ³n esto se valida contra Supabase Auth)
  const adminPin = window.ENV.ADMIN_PIN || '1234'
  if (pin === adminPin) {
    document.getElementById('login-screen').classList.add('hiding')
    setTimeout(() => {
      document.getElementById('login-screen').style.display='none'
      document.getElementById('app').style.display='flex'
      initApp()
    }, 500)
  } else {
    err.textContent='PIN incorrecto.'
    document.getElementById('pin-input').value=''
    for(let i=0;i<4;i++) document.getElementById('pd'+i).classList.remove('filled')
    setTimeout(()=>err.textContent='', 2500)
  }
}

window.logout = function() {
  document.getElementById('app').style.display='none'
  const ls = document.getElementById('login-screen')
  ls.style.display='flex'; ls.classList.remove('hiding')
  document.getElementById('pin-input').value=''
  for(let i=0;i<4;i++) document.getElementById('pd'+i).classList.remove('filled')
}

// â•â•â• INIT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function initApp() {
  setTopbarDate()
  await Promise.all([cargarFranjasConf(), cargarHorarios()])
  buildCalStrip()
  await renderAgenda()
  renderEstadisticas()
  renderFranjasConfig()
  renderHorarioGrid()
  renderMultiplicadores()
  updateBadges()
  // Realtime para notificaciones de nuevas reservas
  suscribirAdmin()
}

function setTopbarDate() {
  const d = new Date()
  document.getElementById('topbar-date').textContent =
    `${DIAS_FULL[d.getDay()]} ${d.getDate()} de ${MESES_ES[d.getMonth()].charAt(0).toUpperCase()+MESES_ES[d.getMonth()].slice(1)} ${d.getFullYear()}`
}

// PestaÃ±a activa para saber quÃ© re-renderizar
let tabActiva = 'agenda'

function suscribirAdmin() {
  if (channelAdmin) sb.removeChannel(channelAdmin)
  channelAdmin = sb.channel('admin-realtime-all')

    // â”€â”€ RESERVAS (INSERT / UPDATE / DELETE) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'reservas' }, (payload) => {
      showToast('ğŸ”” Nueva reserva recibida')
      updateBadges()
      if (tabActiva === 'agenda')      renderAgenda()
      if (tabActiva === 'reservas')    renderReservas()
      if (tabActiva === 'historial')   renderHistorial(histFilter)
      if (tabActiva === 'estadisticas') renderEstadisticas()
      if (tabActiva === 'finanzas')    renderFinanzas()
    })
    .on('postgres_changes', { event: 'UPDATE', schema: 'public', table: 'reservas' }, () => {
      updateBadges()
      if (tabActiva === 'agenda')      renderAgenda()
      if (tabActiva === 'reservas')    renderReservas()
      if (tabActiva === 'historial')   renderHistorial(histFilter)
      if (tabActiva === 'estadisticas') renderEstadisticas()
      if (tabActiva === 'finanzas')    renderFinanzas()
    })
    .on('postgres_changes', { event: 'DELETE', schema: 'public', table: 'reservas' }, () => {
      updateBadges()
      if (tabActiva === 'agenda')      renderAgenda()
      if (tabActiva === 'reservas')    renderReservas()
      if (tabActiva === 'historial')   renderHistorial(histFilter)
    })

    // â”€â”€ CLIENTES FIJOS (INSERT / UPDATE / DELETE) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'clientes_fijos' }, () => {
      showToast('ğŸ”” Nueva solicitud de cliente fijo')
      updateBadges()
      if (tabActiva === 'fijos') renderFijos()
    })
    .on('postgres_changes', { event: 'UPDATE', schema: 'public', table: 'clientes_fijos' }, () => {
      updateBadges()
      if (tabActiva === 'fijos') renderFijos()
    })
    .on('postgres_changes', { event: 'DELETE', schema: 'public', table: 'clientes_fijos' }, () => {
      updateBadges()
      if (tabActiva === 'fijos') renderFijos()
    })

    // â”€â”€ VENTAS (INSERT) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'ventas_productos' }, () => {
      if (tabActiva === 'finanzas') renderFinanzas()
    })

    // â”€â”€ EVENTOS (INSERT / UPDATE) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    .on('postgres_changes', { event: '*', schema: 'public', table: 'eventos' }, () => {
      if (tabActiva === 'eventos') renderEventos()
    })

    .subscribe((status) => {
      if (status === 'SUBSCRIBED') {
        console.log('[Realtime] Conectado a todas las tablas âœ“')
      }
    })
}

// â•â•â• NAV â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const tabTitles = {
  agenda:'Agenda Diaria', estadisticas:'EstadÃ­sticas', historial:'Historial',
  reservas:'Reservas', fijos:'Clientes Fijos', eventos:'Eventos',
  finanzas:'Finanzas', cancha:'Cancha', pagos:'Datos de Pago', horarios:'Horarios'
}

window.nav = function(id, btn) {
  tabActiva = id
  document.querySelectorAll('.tab-panel').forEach(p=>p.classList.remove('active'))
  document.getElementById('tab-'+id).classList.add('active')
  document.querySelectorAll('.sb-item').forEach(b=>b.classList.remove('active'))
  btn.classList.add('active')
  document.getElementById('topbar-title').textContent = tabTitles[id]||id
  const actions = {
    historial:    ()=>renderHistorial('all'),
    reservas:     ()=>renderReservas(),
    fijos:        ()=>renderFijos(),
    eventos:      ()=>renderEventos(),
    finanzas:     ()=>renderFinanzas(),
    estadisticas: ()=>renderEstadisticas(),
  }
  actions[id]?.()
}

// â•â•â• AGENDA â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildCalStrip() {
  const strip = document.getElementById('cal-strip')
  const today = new Date(); today.setHours(0,0,0,0)
  strip.innerHTML = ''
  for (let i=0; i<7; i++) {
    const d = new Date(today); d.setDate(today.getDate()+i)
    const btn = document.createElement('div')
    btn.className = 'cal-day' + (i===0?' active':'')
    btn.innerHTML=`<span class="cal-day-name">${DIAS_ES[d.getDay()]}</span><span class="cal-day-num">${d.getDate()}</span><div class="cal-dots"></div>`
    btn.addEventListener('click', async () => {
      if (btn.classList.contains('past')) return
      document.querySelectorAll('.cal-day').forEach(b=>b.classList.remove('active'))
      btn.classList.add('active')
      selDate=d; selDayIdx=i; await renderAgenda()
    })
    strip.appendChild(btn)
  }
}

async function renderAgenda() {
  const fecha = selDate.toISOString().split('T')[0]
  const dow   = selDate.getDay()

  document.getElementById('crono-title').textContent =
    `${DIAS_FULL[dow]} ${selDate.getDate()} de ${MESES_ES[selDate.getMonth()].charAt(0).toUpperCase()+MESES_ES[selDate.getMonth()].slice(1)}`

  // Stats del dÃ­a
  const { data: stats } = await sb.rpc('stats_dia', { p_fecha: fecha })
  if (stats) {
    document.getElementById('kpi-total').textContent = stats.total || 0
    document.getElementById('kpi-pend').textContent  = stats.pendientes || 0
    document.getElementById('kpi-conf').textContent  = stats.confirmados || 0
    document.getElementById('kpi-bloq').textContent  = stats.bloqueados || 0
  }
  document.getElementById('crono-meta').textContent = `${stats?.total||0} reservas Â· ${stats?.pendientes||0} pendientes`

  // Reservas del dÃ­a
  const { data: reservas } = await sb.from('reservas')
    .select('*').eq('fecha', fecha).not('estado','eq','cancelado').order('hora_inicio')

  const body = document.getElementById('cronograma-body')
  const AP=7, CI=23
  let html = ''

  for (let h=AP; h<CI; h++) {
    const time    = String(h).padStart(2,'0')+':00'
    const timeEnd = String(h+1).padStart(2,'0')+':00'
    const res     = (reservas||[]).find(r => r.hora_inicio.startsWith(String(h).padStart(2,'0')+':'))

    if (res) {
      const sc = {pendiente:'chip-pendiente',confirmado:'chip-confirmado',cancelado:'chip-cancelado',bloqueado:'chip-bloqueado'}[res.estado]||'chip-libre'
      const stxt = res.estado.toUpperCase()
      let acts = ''
      if(res.estado==='pendiente') acts=`<button class="btn btn-approve btn-sm" onclick="confirmarRes('${res.id}')">âœ“</button><button class="btn btn-cancel-act btn-sm" onclick="cancelarRes('${res.id}')">âœ—</button>`
      else if(res.estado==='confirmado'&&res.tipo!=='bloqueo') acts=`<button class="btn btn-free btn-sm" onclick="liberarRes('${res.id}','${time}')">ğŸ”“ Liberar</button>`
      else if(res.tipo==='bloqueo') acts=`<button class="btn btn-cancel-act btn-sm" onclick="liberarRes('${res.id}','${time}')">ğŸ”“</button>`

      html+=`<div class="crono-row">
        <div class="crono-hora">${time}</div>
        <div class="crono-info">
          <span class="crono-cliente">${res.tipo==='bloqueo'?'ğŸ”’ Bloqueado':res.cliente_nombre}</span>
          <span class="crono-detail">${res.cliente_tel||'â€”'} Â· hasta ${timeEnd}${res.precio?` Â· $${res.precio.toLocaleString('es-CO')}`:''}${(res.saldo_pendiente>0)?` Â· <span style="color:var(--red);font-weight:700">Debe $${res.saldo_pendiente.toLocaleString('es-CO')}</span>`:' Â· <span style="color:var(--neon);font-size:10px">âœ“ Pagado</span>'} ${res.tipo==='fijo'?'Â· ğŸ”’ Fijo':''}</span>
        </div>
        <div class="crono-status"><span class="chip ${sc}">${stxt}</span>${acts}</div>
      </div>`
    } else {
      html+=`<div class="crono-row">
        <div class="crono-hora">${time}</div>
        <div class="crono-info"><span class="crono-cliente" style="color:var(--t3)">Disponible</span></div>
        <div class="crono-status"><span class="chip chip-libre">LIBRE</span>
          <button class="btn btn-neon btn-sm" onclick="openNuevaReservaHora('${time}','${fecha}')">+</button>
        </div>
      </div>`
    }
  }
  body.innerHTML = html

  // Actualizar dots del cal-strip
  const btns = document.querySelectorAll('.cal-day')
  btns.forEach(async (btn, i) => {
    const d2 = new Date(); d2.setDate(new Date().getDate()+i); d2.setHours(0,0,0,0)
    const f2 = d2.toISOString().split('T')[0]
    const { data: r } = await sb.from('reservas').select('estado').eq('fecha',f2).not('estado','eq','cancelado')
    const pend = (r||[]).filter(x=>x.estado==='pendiente').length
    const conf = (r||[]).filter(x=>x.estado==='confirmado').length
    const dotsEl = btn.querySelector('.cal-dots')
    if (dotsEl) dotsEl.innerHTML=(pend?'<span class="cdot cdot-y"></span>':'')+(conf?'<span class="cdot cdot-g"></span>':'')
  })
}

// â•â•â• ACCIONES RESERVAS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â”€â”€ Helper: ejecutar operaciÃ³n con bypass de RLS si falla â”€â”€â”€â”€â”€â”€
// El admin usa PIN (no auth de Supabase), entonces el DELETE/UPDATE
// puede ser bloqueado por RLS. Usamos una funciÃ³n con SECURITY DEFINER
// o desactivamos RLS para estas tablas en el admin.
async function adminDelete(tabla, id) {
  const { error } = await sb.from(tabla).delete().eq('id', id)
  if (error) {
    console.error(`[RLS] DELETE ${tabla}:`, error)
    throw new Error(`No se pudo eliminar. Verifica las polÃ­ticas RLS en Supabase para la tabla "${tabla}". Detalle: ${error.message}`)
  }
}

async function adminUpdate(tabla, id, payload) {
  const { error } = await sb.from(tabla).update(payload).eq('id', id)
  if (error) {
    console.error(`[RLS] UPDATE ${tabla}:`, error)
    throw new Error(`No se pudo actualizar. Verifica las polÃ­ticas RLS en Supabase. Detalle: ${error.message}`)
  }
}

window.confirmarRes = async function(id) {
  try {
    await adminUpdate('reservas', id, { estado: 'confirmado' })
    showToast('âœ… Reserva confirmada')
  } catch(e) { showToast('âŒ ' + e.message); return }
  await renderAgenda(); await renderReservas(); updateBadges()
}

window.cancelarRes = async function(id) {
  try {
    await adminUpdate('reservas', id, { estado: 'cancelado' })
    showToast('ğŸš« Reserva cancelada')
  } catch(e) { showToast('âŒ ' + e.message); return }
  await renderAgenda(); await renderReservas(); updateBadges()
}

window.liberarRes = async function(id, hora) {
  if (!confirm(`Â¿Eliminar la reserva de las ${hora} y liberar el cupo?`)) return
  try {
    await adminDelete('reservas', id)
    showToast(`ğŸ”“ Slot ${hora} liberado`)
  } catch(e) { showToast('âŒ ' + e.message); return }
  await renderAgenda(); await renderReservas(); updateBadges()
}

async function updateBadges() {
  const { data } = await sb.from('reservas').select('id').eq('estado','pendiente')
  const p = (data||[]).length
  const br = document.getElementById('badge-res')
  br.textContent=p; br.style.display=p>0?'':'none'

  const { data: s } = await sb.from('clientes_fijos').select('id').eq('estado','solicitud')
  const sf = (s||[]).length
  const bf = document.getElementById('badge-fijos')
  bf.textContent=sf; bf.style.display=sf>0?'':'none'
}

// â•â•â• HISTORIAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let histFilter = 'all'
window.filterHist = function(btn, f) {
  histFilter=f
  document.querySelectorAll('#hist-filters .filter-pill').forEach(b=>b.classList.remove('active'))
  btn.classList.add('active')
  renderHistorial(f)
}

async function renderHistorial(f) {
  let q = sb.from('reservas').select('*').order('fecha',{ascending:false}).order('hora_inicio')
  if (f==='fijo') q=q.eq('tipo','fijo')
  else if (f!=='all') q=q.eq('estado',f)
  const { data } = await q
  document.getElementById('hist-tbody').innerHTML = (data||[]).map(buildResRow).join('')
}

async function renderReservas() {
  const { data } = await sb.from('reservas').select('*').order('fecha',{ascending:false}).order('hora_inicio')
  document.getElementById('res-tbody').innerHTML = (data||[]).map(buildResRow).join('')
}

function buildResRow(r) {
  const sc = {pendiente:'chip-pendiente',confirmado:'chip-confirmado',cancelado:'chip-cancelado',bloqueado:'chip-bloqueado'}[r.estado]||'chip-libre'
  const tc = {fijo:'chip-fijo',bloqueo:'chip-bloqueado'}[r.tipo]||'chip-confirmado'
  let acts = ''
  if(r.estado==='pendiente') acts=`<button class="btn btn-approve btn-sm" onclick="confirmarRes('${r.id}')">âœ“ OK</button><button class="btn btn-cancel-act btn-sm" onclick="cancelarRes('${r.id}')">âœ—</button>`
  else if(r.estado==='confirmado'&&r.tipo!=='bloqueo') acts=`<button class="btn btn-free btn-sm" onclick="liberarRes('${r.id}','${r.hora_inicio}')">ğŸ”“ Liberar</button>`
  else acts='â€”'
  const hi = (r.hora_inicio||'').slice(0,5)
  const hf = (r.hora_fin||'').slice(0,5)
  const abono = r.abono || 0
  const saldo = r.saldo_pendiente || 0
  const abonoHtml = abono > 0
    ? `<span style="font-family:var(--fh);font-size:13px;font-weight:800;color:var(--gold)">$${abono.toLocaleString('es-CO')}</span>`
    : '<span style="color:var(--t3)">â€”</span>'
  const saldoHtml = saldo > 0
    ? `<span style="font-family:var(--fh);font-size:13px;font-weight:800;color:var(--red)">$${saldo.toLocaleString('es-CO')}</span>`
    : '<span style="color:var(--neon);font-size:12px">âœ“ Al dÃ­a</span>'
  return `<tr>
    <td><strong>${r.cliente_nombre}</strong><br><span style="font-size:11px;color:var(--t3)">${r.cliente_tel||'â€”'}</span></td>
    <td>${r.fecha}</td>
    <td class="td-mono">${hi}â€“${hf}</td>
    <td class="td-mono" style="color:var(--neon)">${r.precio>0?'$'+r.precio.toLocaleString('es-CO'):'â€”'}</td>
    <td>${abonoHtml}</td>
    <td>${saldoHtml}</td>
    <td><span class="chip ${tc}" style="font-size:9px">${(r.tipo||'normal').toUpperCase()}</span></td>
    <td><span class="chip ${sc}" style="font-size:9px">${r.estado.toUpperCase()}</span></td>
    <td>${acts}</td>
  </tr>`
}

// â•â•â• CLIENTES FIJOS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function renderFijos() {
  const [{ data: solicitudes }, { data: activos }] = await Promise.all([
    sb.from('clientes_fijos').select('*').eq('estado','solicitud').order('created_at',{ascending:false}),
    sb.from('clientes_fijos').select('*').eq('estado','activo').order('nombre'),
  ])

  const ss = document.getElementById('solicitudes-section')
  ss.innerHTML = (solicitudes||[]).length > 0
    ? `<div class="sec-hd"><span class="sec-title" style="color:var(--gold)">â³ Solicitudes (${solicitudes.length})</span></div>` +
      (solicitudes||[]).map(s=>`
        <div class="solicitud-item">
          <div class="sol-row1"><span class="sol-name">${s.nombre}</span><span class="sol-time">${timeSince(s.created_at)}</span></div>
          <div class="sol-details">${s.telefono||'â€”'} Â· Pide: <strong style="color:var(--t1)">${DIAS_FULL[s.dia_semana]} a las ${(s.hora_inicio||'').slice(0,5)}</strong> Â· ${s.personas||10} personas</div>
          <div class="sol-actions">
            <button class="btn btn-approve btn-sm" onclick="aprobarFijo('${s.id}')">âœ“ Aprobar</button>
            <button class="btn btn-cancel-act btn-sm" onclick="rechazarFijo('${s.id}')">âœ— Rechazar</button>
          </div>
        </div>`).join('')
    : '<div style="font-size:12px;color:var(--t3);padding:4px 0 16px">No hay solicitudes pendientes âœ“</div>'

  document.getElementById('fijos-grid').innerHTML = (activos||[]).map(f=>`
    <div class="fijo-card">
      <div class="fc-header">
        <div><div class="fc-name">${f.nombre}</div><div class="fc-tel">ğŸ“ ${f.telefono||'â€”'}</div></div>
        <span class="chip chip-fijo" style="font-size:9px">FIJO</span>
      </div>
      <div class="fc-schedule">
        <span class="fc-dia">${DIAS_FULL[f.dia_semana]}</span>
        <span class="fc-sep">Â·</span>
        <span class="fc-hora">${(f.hora_inicio||'').slice(0,5)}</span>
        <span class="fc-persons">Â· ğŸ‘¥ ${f.personas||10}</span>
      </div>
      <div class="fc-desde">Desde ${new Date(f.created_at).toLocaleDateString('es-CO',{month:'short',year:'numeric'})}</div>
      <div class="fc-actions">
        <button class="btn btn-edit btn-sm" onclick="editFijo('${f.id}','${f.nombre}','${f.telefono||''}',${f.dia_semana},'${(f.hora_inicio||'').slice(0,5)}')">âœï¸ Editar</button>
        <button class="btn btn-cancel-act btn-sm" onclick="desactivarFijo('${f.id}','${f.nombre}')">ğŸ”“ Desactivar</button>
      </div>
    </div>`).join('')
  updateBadges()
}

window.aprobarFijo = async function(id) {
  try {
    await adminUpdate('clientes_fijos', id, { estado: 'activo' })
    showToast('âœ… Cliente fijo activado')
  } catch(e) { showToast('âŒ ' + e.message); return }
  await renderFijos(); updateBadges()
}

window.rechazarFijo = async function(id) {
  if (!confirm('Â¿Rechazar y eliminar esta solicitud?')) return
  try {
    await adminDelete('clientes_fijos', id)
    showToast('ğŸ—‘ Solicitud eliminada')
  } catch(e) { showToast('âŒ ' + e.message); return }
  await renderFijos(); updateBadges()
}

window.desactivarFijo = async function(id, nombre) {
  if (!confirm(`Â¿Desactivar el cupo fijo de ${nombre}?`)) return
  try {
    await adminUpdate('clientes_fijos', id, { estado: 'inactivo' })
    showToast(`ğŸ”“ Cupo de ${nombre} desactivado`)
  } catch(e) { showToast('âŒ ' + e.message); return }
  await renderFijos(); updateBadges()
}

// â•â•â• EVENTOS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function renderEventos() {
  const { data } = await sb.from('eventos').select('*').order('created_at',{ascending:false})
  document.getElementById('ev-tbody').innerHTML = (data||[]).map(e=>`<tr>
    <td><strong>${e.titulo}</strong></td>
    <td><span class="chip chip-fijo" style="font-size:9px">${e.tipo.toUpperCase()}</span></td>
    <td>${e.fecha_inicio ? new Date(e.fecha_inicio).toLocaleDateString('es-CO') : 'Por definir'}</td>
    <td class="td-mono" style="color:var(--gold)">$${(e.precio||0).toLocaleString('es-CO')}</td>
    <td style="color:var(--t2)">${e.cupos_ocupados}/${e.cupos_total===99?'âˆ':e.cupos_total}</td>
    <td><span class="chip ${e.estado==='activo'?'chip-confirmado':'chip-cancelado'}" style="font-size:9px">${e.estado.toUpperCase()}</span></td>
    <td>
      <button class="btn btn-edit btn-sm" onclick="editEvento('${e.id}')">âœï¸</button>
      <button class="btn ${e.estado==='activo'?'btn-cancel-act':'btn-approve'} btn-sm" onclick="toggleEvento('${e.id}','${e.estado}')">${e.estado==='activo'?'Cerrar':'Abrir'}</button>
    </td>
  </tr>`).join('')
}

window.toggleEvento = async function(id, estadoActual) {
  const nuevo = estadoActual==='activo'?'cerrado':'activo'
  await sb.from('eventos').update({estado:nuevo}).eq('id',id)
  await renderEventos(); showToast(`Evento ${nuevo}`)
}

// â•â•â• FINANZAS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function renderFinanzas() {
  // â”€â”€ Rango: Ãºltimos 7 dÃ­as â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const hoy = new Date()
  const desdeDate = new Date(); desdeDate.setDate(hoy.getDate()-6); desdeDate.setHours(0,0,0,0)
  const desde = desdeDate.toISOString().split('T')[0]
  const mesInicio = `${hoy.getFullYear()}-${String(hoy.getMonth()+1).padStart(2,'0')}-01`

  // Traer todo en paralelo
  const [
    { data: resConfirmadas },
    { data: resMes },
    { data: ventas7d },
    { data: ventasMes },
    { data: prods },
    { data: movs }
  ] = await Promise.all([
    sb.from('reservas').select('fecha, hora_inicio, precio').gte('fecha', desde).eq('estado','confirmado'),
    sb.from('reservas').select('precio').gte('fecha', mesInicio).eq('estado','confirmado'),
    sb.from('ventas_productos').select('producto_id, cantidad, total').gte('created_at', desde+'T00:00:00'),
    sb.from('ventas_productos').select('total').gte('created_at', mesInicio+'T00:00:00'),
    sb.from('productos').select('*, ventas_productos(cantidad,total)').eq('activo',true).order('nombre'),
    sb.from('ventas_productos').select('id, created_at, total, productos(nombre)').order('created_at',{ascending:false}).limit(30),
  ])

  // â”€â”€ KPIs del mes â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const totalCancha = (resMes||[]).reduce((s,r)=>s+r.precio,0)
  const totalTienda = (ventasMes||[]).reduce((s,v)=>s+v.total,0)
  const totalMes    = totalCancha + totalTienda
  const diasMes     = hoy.getDate()
  const promDia     = diasMes > 0 ? Math.round(totalMes / diasMes) : 0

  const kpis = document.getElementById('fin-kpis')
  if (kpis) kpis.innerHTML = `
    <div class="kpi-card"><div class="kpi-accent" style="background:var(--neon)"></div>
      <div class="kpi-lbl">Total Mes</div><div class="kpi-val">${fmtK(totalMes)}</div></div>
    <div class="kpi-card"><div class="kpi-accent" style="background:var(--blue)"></div>
      <div class="kpi-lbl">Cancha</div><div class="kpi-val">${fmtK(totalCancha)}</div></div>
    <div class="kpi-card"><div class="kpi-accent" style="background:var(--gold)"></div>
      <div class="kpi-lbl">Tienda</div><div class="kpi-val">${fmtK(totalTienda)}</div></div>
    <div class="kpi-card"><div class="kpi-accent" style="background:var(--purple)"></div>
      <div class="kpi-lbl">Promedio/dÃ­a</div><div class="kpi-val">${fmtK(promDia)}</div></div>`

  // â”€â”€ Ingresos por dÃ­a (Ãºltimos 7) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const diasMap = {}
  for (let i=0; i<7; i++) {
    const d = new Date(desdeDate); d.setDate(desdeDate.getDate()+i)
    const k = d.toISOString().split('T')[0]
    diasMap[k] = { lbl: DIAS_ES[d.getDay()], v: 0 }
  }
  for (const r of (resConfirmadas||[])) {
    if (diasMap[r.fecha]) diasMap[r.fecha].v += r.precio
  }
  // Sumar tienda por dÃ­a
  for (const v of (ventas7d||[])) {
    const k = v.created_at ? v.created_at.split('T')[0] : null
    if (k && diasMap[k]) diasMap[k].v += v.total
  }
  const diasArr = Object.values(diasMap)
  const maxD = Math.max(...diasArr.map(x=>x.v), 1)
  document.getElementById('fin-dias').innerHTML = diasArr.map(x=>`
    <div class="bar-row">
      <span class="bar-lbl">${x.lbl}</span>
      <div class="bar-track"><div class="bar-fill g" style="width:${(x.v/maxD*100).toFixed(0)}%;transition:width .6s ease"></div></div>
      <span class="bar-val">${x.v>0?fmtK(x.v):'$0'}</span>
    </div>`).join('')

  // â”€â”€ Ingresos por franja (hora real) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const fr = [{l:'MaÃ±ana 7â€“12',v:0,c:'g'},{l:'Tarde 12â€“18',v:0,c:'y'},{l:'Noche 18â€“23',v:0,c:'b'}]
  for (const r of (resConfirmadas||[])) {
    const h = parseInt((r.hora_inicio||'00').slice(0,2))
    if (h>=7  && h<12) fr[0].v += r.precio
    else if (h>=12 && h<18) fr[1].v += r.precio
    else if (h>=18)          fr[2].v += r.precio
  }
  const maxF = Math.max(...fr.map(x=>x.v), 1)
  document.getElementById('fin-franjas').innerHTML = fr.map(x=>`
    <div class="bar-row">
      <span class="bar-lbl" style="width:88px;font-size:10px">${x.l}</span>
      <div class="bar-track"><div class="bar-fill ${x.c}" style="width:${(x.v/maxF*100).toFixed(0)}%;transition:width .6s ease"></div></div>
      <span class="bar-val">${x.v>0?fmtK(x.v):'$0'}</span>
    </div>`).join('')

  // â”€â”€ Tienda: productos con ventas reales â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const ventasMap = {}
  for (const v of (ventas7d||[])) {
    if (!ventasMap[v.producto_id]) ventasMap[v.producto_id] = {cant:0,total:0}
    ventasMap[v.producto_id].cant  += v.cantidad
    ventasMap[v.producto_id].total += v.total
  }
  document.getElementById('tienda-list').innerHTML = (prods||[]).length > 0
    ? (prods||[]).map(p=>`
    <div class="product-item" onclick="registrarVenta('${p.id}',${p.precio})">
      <div class="prod-icon">${p.emoji||'ğŸ“¦'}</div>
      <div><div class="prod-name">${p.nombre}</div><div class="prod-price">$${p.precio.toLocaleString('es-CO')} c/u</div></div>
      <div class="prod-right">
        <span class="prod-sold">${ventasMap[p.id]?.cant||0} vendidos</span>
        <span class="prod-total">$${(ventasMap[p.id]?.total||0).toLocaleString('es-CO')}</span>
        <button class="btn btn-edit btn-sm" onclick="event.stopPropagation();editProducto('${p.id}','${p.nombre}',${p.precio},'${p.emoji||''}')">âœï¸</button>
      </div>
    </div>`).join('')
    : '<div style="padding:20px;color:var(--t3);font-size:13px;text-align:center">No hay productos aÃºn. Agrega uno con el botÃ³n +</div>'

  // â”€â”€ Movimientos: reservas confirmadas + ventas mezcladas â”€â”€
  const movsReservas = (resConfirmadas||[])
    .filter(r=>r.precio>0)
    .slice(0,15)
    .map(r=>({
      tipo:'cancha',
      desc:`Cancha ${(r.hora_inicio||'').slice(0,5)}`,
      fecha: r.fecha,
      monto: r.precio
    }))
  const movsTienda = (movs||[]).slice(0,15).map(m=>({
    tipo:'tienda',
    desc:`Venta - ${m.productos?.nombre||'Producto'}`,
    fecha: m.created_at ? new Date(m.created_at).toLocaleDateString('es-CO') : 'â€”',
    hora:  m.created_at ? new Date(m.created_at).toLocaleTimeString('es-CO',{hour:'2-digit',minute:'2-digit'}) : 'â€”',
    monto: m.total
  }))
  const todosMovs = [...movsReservas,...movsTienda]
    .sort((a,b)=> new Date(b.fecha)-new Date(a.fecha))
    .slice(0,25)

  document.getElementById('movs-tbody').innerHTML = todosMovs.length > 0
    ? todosMovs.map(m=>`<tr>
        <td><strong>${m.desc}</strong></td>
        <td><span class="mv-cat-${m.tipo}">${m.tipo==='cancha'?'Cancha':'Tienda'}</span></td>
        <td style="color:var(--t2);font-size:12px">${m.hora||m.fecha}</td>
        <td class="td-mono" style="color:var(--neon)">+$${m.monto.toLocaleString('es-CO')}</td>
      </tr>`).join('')
    : '<tr><td colspan="4" style="text-align:center;color:var(--t3);padding:24px">Sin movimientos aÃºn</td></tr>'
}

// â”€â”€ EstadÃ­sticas 100% reales â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function renderEstadisticas() {
  // Ãšltimos 30 dÃ­as para estadÃ­sticas del mes
  const hoy = new Date()
  const mesInicio = `${hoy.getFullYear()}-${String(hoy.getMonth()+1).padStart(2,'0')}-01`
  const hace30 = new Date(); hace30.setDate(hoy.getDate()-29)
  const desde30 = hace30.toISOString().split('T')[0]

  const [
    { data: resMes },
    { data: resTotal }
  ] = await Promise.all([
    sb.from('reservas').select('fecha, hora_inicio, estado, precio').gte('fecha', mesInicio),
    sb.from('reservas').select('fecha, hora_inicio, estado, precio').gte('fecha', desde30),
  ])

  const todas = resTotal || []

  // â”€â”€ KPIs estadÃ­sticas â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const confirmadas = todas.filter(r=>r.estado==='confirmado')
  const ingresosMes = (resMes||[]).filter(r=>r.estado==='confirmado').reduce((s,r)=>s+r.precio,0)
  const totalRes    = (resMes||[]).filter(r=>r.estado!=='bloqueado').length
  const totalConf   = (resMes||[]).filter(r=>r.estado==='confirmado').length
  const ocupPct     = totalRes > 0 ? Math.round((totalConf/totalRes)*100) : 0

  const { data: fijosCount } = await sb.from('clientes_fijos').select('id').eq('estado','activo')

  const statKpis = document.getElementById('stat-kpis')
  if (statKpis) statKpis.innerHTML = `
    <div class="kpi-card"><div class="kpi-accent" style="background:var(--neon)"></div>
      <div class="kpi-lbl">Ingresos Mes</div><div class="kpi-val">${fmtK(ingresosMes)}</div></div>
    <div class="kpi-card"><div class="kpi-accent" style="background:var(--blue)"></div>
      <div class="kpi-lbl">Reservas Mes</div><div class="kpi-val">${totalConf}</div></div>
    <div class="kpi-card"><div class="kpi-accent" style="background:var(--gold)"></div>
      <div class="kpi-lbl">OcupaciÃ³n</div><div class="kpi-val">${ocupPct}%</div></div>
    <div class="kpi-card"><div class="kpi-accent" style="background:var(--purple)"></div>
      <div class="kpi-lbl">Clientes Fijos</div><div class="kpi-val">${(fijosCount||[]).length}</div></div>`

  // â”€â”€ Ingresos por dÃ­a de semana (Ãºltimos 30d) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const porDia = Array(7).fill(0)   // Ã­ndice 0=Dom
  const cntDia  = Array(7).fill(0)
  for (const r of confirmadas) {
    const dow = new Date(r.fecha+'T12:00').getDay()
    porDia[dow] += r.precio
    cntDia[dow]++
  }
  const diasLabels = [1,2,3,4,5,6,0] // Lunâ†’Dom
  const diasData = diasLabels.map(i=>({d:DIAS_ES[i], v:porDia[i], n:cntDia[i]}))
  const maxDia = Math.max(...diasData.map(x=>x.v),1)
  document.getElementById('stat-dias-chart').innerHTML = diasData.map(x=>`
    <div class="bar-row">
      <span class="bar-lbl">${x.d}</span>
      <div class="bar-track"><div class="bar-fill g" style="width:${(x.v/maxDia*100).toFixed(0)}%;transition:width .6s ease"></div></div>
      <span class="bar-val">${x.v>0?fmtK(x.v):'$0'}</span>
    </div>`).join('')

  // â”€â”€ Reservas por franja horaria â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const franjaData = [{l:'MaÃ±ana',v:0,c:'g'},{l:'Tarde',v:0,c:'y'},{l:'Noche',v:0,c:'b'}]
  for (const r of todas.filter(r=>r.estado==='confirmado')) {
    const h = parseInt((r.hora_inicio||'00').slice(0,2))
    if (h>=7 && h<12)      franjaData[0].v++
    else if (h>=12 && h<18) franjaData[1].v++
    else if (h>=18)          franjaData[2].v++
  }
  const maxFr = Math.max(...franjaData.map(x=>x.v),1)
  document.getElementById('stat-franja-chart').innerHTML = franjaData.map(x=>`
    <div class="bar-row">
      <span class="bar-lbl">${x.l}</span>
      <div class="bar-track"><div class="bar-fill ${x.c}" style="width:${(x.v/maxFr*100).toFixed(0)}%;transition:width .6s ease"></div></div>
      <span class="bar-val">${x.v} res</span>
    </div>`).join('')

  // â”€â”€ DÃ­as mÃ¡s populares (conteo de reservas confirmadas) â”€â”€â”€
  const popMap = {}
  for (const r of confirmadas) {
    const dow = new Date(r.fecha+'T12:00').getDay()
    const lbl = DIAS_FULL[dow]
    popMap[lbl] = (popMap[lbl]||0)+1
  }
  const popArr = Object.entries(popMap).sort((a,b)=>b[1]-a[1]).slice(0,5)
  const maxPop = Math.max(...popArr.map(x=>x[1]),1)
  document.getElementById('stat-popularidad-chart').innerHTML = popArr.length > 0
    ? popArr.map(([d,v])=>`
      <div class="bar-row">
        <span class="bar-lbl" style="font-size:10px;width:76px">${d.slice(0,3)}</span>
        <div class="bar-track"><div class="bar-fill g" style="width:${(v/maxPop*100).toFixed(0)}%;transition:width .6s ease"></div></div>
        <span class="bar-val">${v} res</span>
      </div>`).join('')
    : '<div style="color:var(--t3);font-size:12px;padding:8px">Sin datos aÃºn</div>'

  // â”€â”€ Estado de reservas (distribuciÃ³n %) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const total30 = todas.length || 1
  const estMap = {
    confirmado: todas.filter(r=>r.estado==='confirmado').length,
    pendiente:  todas.filter(r=>r.estado==='pendiente').length,
    cancelado:  todas.filter(r=>r.estado==='cancelado').length,
  }
  const estData = [
    {l:'Confirmadas',v:estMap.confirmado,c:'g'},
    {l:'Canceladas', v:estMap.cancelado, c:'r'},
    {l:'Pendientes', v:estMap.pendiente, c:'y'},
  ]
  const maxEst = Math.max(...estData.map(x=>x.v),1)
  document.getElementById('stat-estado-chart').innerHTML = estData.map(x=>`
    <div class="bar-row">
      <span class="bar-lbl" style="font-size:10px;width:76px">${x.l}</span>
      <div class="bar-track"><div class="bar-fill ${x.c}" style="width:${(x.v/maxEst*100).toFixed(0)}%;transition:width .6s ease"></div></div>
      <span class="bar-val">${total30>0?Math.round(x.v/total30*100):0}%</span>
    </div>`).join('')
}

// â”€â”€ Formateador compacto â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function fmtK(n) {
  if (n >= 1000000) return '$' + (n/1000000).toFixed(1) + 'M'
  if (n >= 1000)    return '$' + (n/1000).toFixed(0) + 'k'
  return '$' + n.toLocaleString('es-CO')
}

window.registrarVenta = async function(prodId, precio) {
  const { error } = await sb.from('ventas_productos').insert({producto_id:prodId,cantidad:1,precio_unit:precio})
  if (error) { showToast('âŒ '+error.message); return }
  await renderFinanzas(); showToast('ğŸ›’ Venta registrada')
}

// â•â•â• CONFIGURACIÃ“N â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function cargarFranjasConf() {
  const { data } = await sb.from('franjas_precio').select('*').order('hora_inicio')
  franjasConf = data || []
}

function renderFranjasConfig() {
  document.getElementById('franjas-config').innerHTML = franjasConf.map((f,i)=>`
    <div class="price-row">
      <div><div class="price-label">${f.nombre}</div></div>
      <div class="price-range">${f.hora_inicio}:00 â€“ ${f.hora_fin}:00</div>
      <div>
        <div style="font-size:9px;color:var(--t3);letter-spacing:1px;text-transform:uppercase;margin-bottom:4px">Lunâ€“Jue</div>
        <input class="price-edit" type="number" value="${f.precio_lv}" onchange="updateFranja('${f.id}','precio_lv',+this.value)"/>
      </div>
      <div>
        <div style="font-size:9px;color:var(--t3);letter-spacing:1px;text-transform:uppercase;margin-bottom:4px">Vieâ€“Dom</div>
        <input class="price-edit" type="number" value="${f.precio_fsd}" onchange="updateFranja('${f.id}','precio_fsd',+this.value)"/>
      </div>
    </div>`).join('')
}

window.updateFranja = async function(id, campo, valor) {
  const { error } = await sb.from('franjas_precio').update({[campo]:valor}).eq('id',id)
  if (error) showToast('âŒ '+error.message)
  else showToast('ğŸ’¾ Precio actualizado')
}

async function cargarHorarios() {
  const { data } = await sb.from('horarios_operativos').select('*').order('dia_semana')
  horarioOp = data || []
}

function renderHorarioGrid() {
  document.getElementById('horario-grid').innerHTML = horarioOp.map((h,i)=>`
    <div class="horario-item">
      <div class="horario-dia">${DIAS_FULL[h.dia_semana]}
        <label class="toggle-switch">
          <input type="checkbox" ${h.activo?'checked':''} onchange="updateHorario('${h.id}','activo',this.checked)"/>
          <span class="toggle-slider"></span>
        </label>
      </div>
      <div class="horario-times">
        <input type="time" class="time-input" value="${h.apertura.slice(0,5)}" onchange="updateHorario('${h.id}','apertura',this.value)"/>
        <span style="color:var(--t3);font-size:12px">â€“</span>
        <input type="time" class="time-input" value="${h.cierre.slice(0,5)}" onchange="updateHorario('${h.id}','cierre',this.value)"/>
      </div>
    </div>`).join('')
}

window.updateHorario = async function(id, campo, valor) {
  const { error } = await sb.from('horarios_operativos').update({[campo]:valor}).eq('id',id)
  if (error) showToast('âŒ '+error.message)
}

function renderMultiplicadores() {
  document.getElementById('multiplicadores-list').innerHTML=multiplicadores.map((m,i)=>`
    <div style="display:flex;align-items:center;justify-content:space-between;padding:11px 16px;border-radius:9px;background:var(--bg3);border:1px solid var(--border);margin-bottom:6px">
      <div>
        <span style="font-family:var(--fh);font-size:14px;font-weight:800;color:var(--t1)">${m.dia}</span>
        <span style="font-size:11px;color:var(--t3);margin-left:10px">${m.desc}</span>
      </div>
      <div style="display:flex;align-items:center;gap:8px">
        <span class="chip ${m.tipo==='up'?'chip-confirmado':'chip-cancelado'}">${m.val}</span>
        <button class="btn btn-cancel-act btn-sm" onclick="multiplicadores.splice(${i},1);renderMultiplicadores()">âœ—</button>
      </div>
    </div>`).join('')
}

window.saveConfig = function() { showToast('ğŸ’¾ ConfiguraciÃ³n guardada') }

window.updateAbonoMinimo = async function(valor) {
  if (!valor || valor < 1000) { showToast('âš ï¸ Monto mÃ­nimo: $1.000'); return }
  // Actualizar preview en tiempo real
  document.getElementById('cfg-abono-preview').textContent = '$'+valor.toLocaleString('es-CO')
  document.getElementById('cfg-resto-preview').textContent = '$'+(80000-valor).toLocaleString('es-CO')
  // Guardar en Supabase
  const { error } = await sb.from('config_pago').update({ abono_minimo: valor }).eq('id', 1)
  if (error) { showToast('âŒ '+error.message); return }
  showToast(`ğŸ’¾ Abono mÃ­nimo actualizado: $${valor.toLocaleString('es-CO')}`)
}

// â•â•â• MODAL helpers â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function horaOpts(offset=0) {
  let s=''
  for(let h=7+offset;h<=22;h++) s+=`<option value="${String(h).padStart(2,'0')}:00">${String(h).padStart(2,'0')}:00</option>`
  return s
}

window.openModal = function(html) {
  document.getElementById('modal-body').innerHTML=html
  document.getElementById('ov').classList.add('open')
}
window.closeModal = function() { document.getElementById('ov').classList.remove('open') }

// â•â•â• MODALES DE ACCIÃ“N â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

window.openNuevaReserva = function() { openNuevaReservaHora(null, null) }
window.openNuevaReservaHora = function(hora, fecha) {
  const fechaDef = fecha || new Date().toISOString().split('T')[0]
  openModal(`
    <div class="m-head"><div class="m-title">Nueva Reserva</div><button class="m-x" onclick="closeModal()">Ã—</button></div>
    <div class="form-group"><label class="form-label">Cliente</label><input class="form-input" id="nr-n" placeholder="Nombre..."/></div>
    <div class="form-group"><label class="form-label">TelÃ©fono</label><input class="form-input" id="nr-t" placeholder="+57..."/></div>
    <div class="form-group"><label class="form-label">Fecha</label><input type="date" class="form-input" id="nr-f" value="${fechaDef}"/></div>
    <div class="form-2col">
      <div class="form-group"><label class="form-label">Desde</label><select class="form-select" id="nr-hi">${horaOpts()}</select></div>
      <div class="form-group"><label class="form-label">Hasta</label><select class="form-select" id="nr-hf">${horaOpts(1)}</select></div>
    </div>
    <div class="form-group"><label class="form-label">Tipo</label>
      <select class="form-select" id="nr-tp"><option value="normal">Normal</option><option value="fijo">Cliente Fijo</option><option value="evento">Evento</option></select></div>
    <div class="form-group"><label class="form-label">Estado</label>
      <select class="form-select" id="nr-e"><option value="pendiente">Pendiente</option><option value="confirmado">Confirmado</option></select></div>
    <div class="m-btns">
      <button class="m-cancel-btn" onclick="closeModal()">Cancelar</button>
      <button class="m-save-btn" onclick="guardarNuevaReserva()">Guardar</button>
    </div>`)
  if (hora) setTimeout(()=>{ const s=document.getElementById('nr-hi'); if(s)s.value=hora },50)
}

window.guardarNuevaReserva = async function() {
  const nombre=document.getElementById('nr-n').value.trim()
  const tel=document.getElementById('nr-t').value||'â€”'
  const fecha=document.getElementById('nr-f').value
  const hi=document.getElementById('nr-hi').value
  const hf=document.getElementById('nr-hf').value
  const tipo=document.getElementById('nr-tp').value
  const estado=document.getElementById('nr-e').value
  if(!nombre||!fecha){showToast('âš ï¸ Completa nombre y fecha');return}
  const dow=new Date(fecha+'T12:00').getDay()
  const h=parseInt(hi)
  const {data:franjas2}=await sb.from('franjas_precio').select('*').eq('activo',true)
  const f=(franjas2||[]).find(f=>h>=f.hora_inicio&&h<f.hora_fin)
  const precio=f?(dow===0||dow===6?f.precio_fsd:dow===5?f.precio_vie:f.precio_lv):65000
  const {error}=await sb.from('reservas').insert({
    cliente_nombre:nombre,cliente_tel:tel,fecha,
    hora_inicio:hi+':00',hora_fin:hf+':00',
    precio,tipo,estado
  })
  if(error){showToast('âŒ '+error.message);return}
  closeModal(); await renderAgenda(); renderReservas(); updateBadges()
  showToast(`âœ… Reserva de ${nombre} creada`)
}

window.openBloqueo = function() {
  const fechaDef=selDate.toISOString().split('T')[0]
  openModal(`
    <div class="m-head"><div class="m-title">Bloquear Hora</div><button class="m-x" onclick="closeModal()">Ã—</button></div>
    <div class="form-group"><label class="form-label">Motivo</label>
      <select class="form-select" id="bl-m"><option>Mantenimiento</option><option>Uso propio</option><option>Evento</option><option>Otro</option></select></div>
    <div class="form-group"><label class="form-label">Fecha</label><input type="date" class="form-input" id="bl-f" value="${fechaDef}"/></div>
    <div class="form-2col">
      <div class="form-group"><label class="form-label">Desde</label><select class="form-select" id="bl-hi">${horaOpts()}</select></div>
      <div class="form-group"><label class="form-label">Hasta</label><select class="form-select" id="bl-hf">${horaOpts(1)}</select></div>
    </div>
    <div class="m-btns">
      <button class="m-cancel-btn" onclick="closeModal()">Cancelar</button>
      <button class="m-save-btn" style="background:var(--gold);color:#000" onclick="guardarBloqueo()">ğŸ”’ Bloquear</button>
    </div>`)
}

window.guardarBloqueo = async function() {
  const motivo=document.getElementById('bl-m').value
  const fecha=document.getElementById('bl-f').value
  const hi=document.getElementById('bl-hi').value
  const hf=document.getElementById('bl-hf').value
  const {error}=await sb.from('reservas').insert({
    cliente_nombre:'BLOQUEADO',cliente_tel:motivo,fecha,
    hora_inicio:hi+':00',hora_fin:hf+':00',precio:0,tipo:'bloqueo',estado:'bloqueado'
  })
  if(error){showToast('âŒ '+error.message);return}
  closeModal(); await renderAgenda()
  showToast(`ğŸ”’ ${hi} bloqueado (${motivo})`)
}

window.openNuevoFijo = function() {
  openModal(`
    <div class="m-head"><div class="m-title">Registrar Cliente Fijo</div><button class="m-x" onclick="closeModal()">Ã—</button></div>
    <div class="form-group"><label class="form-label">Nombre</label><input class="form-input" id="nf-n" placeholder="Nombre..."/></div>
    <div class="form-group"><label class="form-label">TelÃ©fono</label><input class="form-input" id="nf-t" placeholder="+57..."/></div>
    <div class="form-2col">
      <div class="form-group"><label class="form-label">DÃ­a</label>
        <select class="form-select" id="nf-d">${DIAS_FULL.map((d,i)=>`<option value="${i}">${d}</option>`).join('')}</select></div>
      <div class="form-group"><label class="form-label">Hora</label><select class="form-select" id="nf-h">${horaOpts()}</select></div>
    </div>
    <div class="form-group"><label class="form-label">Personas</label>
      <select class="form-select" id="nf-p"><option value="10">10 (5vs5)</option><option value="12">12 (6vs6)</option></select></div>
    <div class="m-btns">
      <button class="m-cancel-btn" onclick="closeModal()">Cancelar</button>
      <button class="m-save-btn" onclick="guardarFijo()">Registrar</button>
    </div>`)
}

window.guardarFijo = async function() {
  const nombre=document.getElementById('nf-n').value.trim()
  if(!nombre){showToast('âš ï¸ Ingresa el nombre');return}
  const hi=document.getElementById('nf-h').value
  const {error}=await sb.from('clientes_fijos').insert({
    nombre,telefono:document.getElementById('nf-t').value||'â€”',
    dia_semana:+document.getElementById('nf-d').value,
    hora_inicio:hi+':00',hora_fin:String(parseInt(hi)+1).padStart(2,'0')+':00:00',
    personas:+document.getElementById('nf-p').value,estado:'activo'
  })
  if(error){showToast('âŒ '+error.message);return}
  closeModal(); await renderFijos(); showToast(`âœ… ${nombre} registrado`)
}

window.editFijo = function(id,nombre,tel,dia,hora) {
  openModal(`
    <div class="m-head"><div class="m-title">Editar Cliente Fijo</div><button class="m-x" onclick="closeModal()">Ã—</button></div>
    <div class="form-group"><label class="form-label">Nombre</label><input class="form-input" id="ef-n" value="${nombre}"/></div>
    <div class="form-group"><label class="form-label">TelÃ©fono</label><input class="form-input" id="ef-t" value="${tel}"/></div>
    <div class="form-2col">
      <div class="form-group"><label class="form-label">DÃ­a</label>
        <select class="form-select" id="ef-d">${DIAS_FULL.map((d,i)=>`<option value="${i}"${i===dia?' selected':''}>${d}</option>`).join('')}</select></div>
      <div class="form-group"><label class="form-label">Hora</label><select class="form-select" id="ef-h">${horaOpts()}</select></div>
    </div>
    <div class="m-btns">
      <button class="m-cancel-btn" onclick="closeModal()">Cancelar</button>
      <button class="m-save-btn" onclick="saveEditFijo('${id}')">Guardar</button>
    </div>`)
  setTimeout(()=>{ const s=document.getElementById('ef-h'); if(s)s.value=hora },50)
}

window.saveEditFijo = async function(id) {
  const hi=document.getElementById('ef-h').value
  const {error}=await sb.from('clientes_fijos').update({
    nombre:document.getElementById('ef-n').value,
    telefono:document.getElementById('ef-t').value,
    dia_semana:+document.getElementById('ef-d').value,
    hora_inicio:hi+':00',hora_fin:String(parseInt(hi)+1).padStart(2,'0')+':00:00',
  }).eq('id',id)
  if(error){showToast('âŒ '+error.message);return}
  closeModal(); await renderFijos(); showToast('âœ… Cliente fijo actualizado')
}

window.openNuevoEvento = function() {
  openModal(`
    <div class="m-head"><div class="m-title">Crear Evento</div><button class="m-x" onclick="closeModal()">Ã—</button></div>
    <div class="form-group"><label class="form-label">Nombre</label><input class="form-input" id="ne-tt" placeholder="Torneo..."/></div>
    <div class="form-group"><label class="form-label">Tipo</label>
      <select class="form-select" id="ne-tp"><option value="torneo">Torneo</option><option value="cumpleanos">CumpleaÃ±os</option><option value="campeonato">Campeonato</option><option value="corporativo">Corporativo</option><option value="otro">Otro</option></select></div>
    <div class="form-2col">
      <div class="form-group"><label class="form-label">Fecha inicio</label><input type="datetime-local" class="form-input" id="ne-f"/></div>
      <div class="form-group"><label class="form-label">Precio</label><input class="form-input" type="number" id="ne-p" placeholder="120000"/></div>
    </div>
    <div class="form-group"><label class="form-label">Cupos</label><input class="form-input" type="number" id="ne-c" placeholder="8"/></div>
    <div class="form-group"><label class="form-label">DescripciÃ³n</label><textarea class="form-textarea" id="ne-d"></textarea></div>
    <div class="m-btns">
      <button class="m-cancel-btn" onclick="closeModal()">Cancelar</button>
      <button class="m-save-btn gold" onclick="guardarEvento()">Crear</button>
    </div>`)
}

window.guardarEvento = async function() {
  const titulo=document.getElementById('ne-tt').value.trim()
  if(!titulo){showToast('âš ï¸ Ingresa el nombre');return}
  const {error}=await sb.from('eventos').insert({
    titulo,tipo:document.getElementById('ne-tp').value,
    fecha_inicio:document.getElementById('ne-f').value||null,
    precio:+document.getElementById('ne-p').value||0,
    cupos_total:+document.getElementById('ne-c').value||10,
    descripcion:document.getElementById('ne-d').value,estado:'activo'
  })
  if(error){showToast('âŒ '+error.message);return}
  closeModal(); await renderEventos(); showToast(`ğŸ† Evento "${titulo}" creado`)
}

window.editEvento = async function(id) {
  const {data:e}=await sb.from('eventos').select('*').eq('id',id).single()
  if(!e)return
  openModal(`
    <div class="m-head"><div class="m-title">Editar Evento</div><button class="m-x" onclick="closeModal()">Ã—</button></div>
    <div class="form-group"><label class="form-label">Nombre</label><input class="form-input" id="ee-t" value="${e.titulo}"/></div>
    <div class="form-2col">
      <div class="form-group"><label class="form-label">Precio</label><input class="form-input" type="number" id="ee-p" value="${e.precio}"/></div>
      <div class="form-group"><label class="form-label">Cupos</label><input class="form-input" type="number" id="ee-c" value="${e.cupos_total}"/></div>
    </div>
    <div class="m-btns">
      <button class="m-cancel-btn" onclick="closeModal()">Cancelar</button>
      <button class="m-save-btn gold" onclick="saveEditEvento('${e.id}')">Guardar</button>
    </div>`)
}

window.saveEditEvento = async function(id) {
  const {error}=await sb.from('eventos').update({
    titulo:document.getElementById('ee-t').value,
    precio:+document.getElementById('ee-p').value,
    cupos_total:+document.getElementById('ee-c').value,
  }).eq('id',id)
  if(error){showToast('âŒ '+error.message);return}
  closeModal(); await renderEventos(); showToast('âœ… Evento actualizado')
}

window.openAddProduct = function() {
  openModal(`
    <div class="m-head"><div class="m-title">Agregar Producto</div><button class="m-x" onclick="closeModal()">Ã—</button></div>
    <div class="form-group"><label class="form-label">Nombre</label><input class="form-input" id="ap-n" placeholder="Agua, Gatorade..."/></div>
    <div class="form-2col">
      <div class="form-group"><label class="form-label">Precio</label><input class="form-input" type="number" id="ap-p" placeholder="3000"/></div>
      <div class="form-group"><label class="form-label">Emoji</label><input class="form-input" id="ap-i" placeholder="ğŸ¥¤" maxlength="2"/></div>
    </div>
    <div class="m-btns">
      <button class="m-cancel-btn" onclick="closeModal()">Cancelar</button>
      <button class="m-save-btn" onclick="guardarProducto()">Agregar</button>
    </div>`)
}

window.guardarProducto = async function() {
  const nombre=document.getElementById('ap-n').value.trim()
  const precio=+document.getElementById('ap-p').value
  if(!nombre||!precio){showToast('âš ï¸ Completa nombre y precio');return}
  const {error}=await sb.from('productos').insert({nombre,precio,emoji:document.getElementById('ap-i').value||'ğŸ“¦',activo:true})
  if(error){showToast('âŒ '+error.message);return}
  closeModal(); await renderFinanzas(); showToast(`âœ… "${nombre}" agregado`)
}

window.editProducto = function(id,nombre,precio,emoji) {
  openModal(`
    <div class="m-head"><div class="m-title">Editar Producto</div><button class="m-x" onclick="closeModal()">Ã—</button></div>
    <div class="form-group"><label class="form-label">Nombre</label><input class="form-input" id="ep-n" value="${nombre}"/></div>
    <div class="form-2col">
      <div class="form-group"><label class="form-label">Precio</label><input class="form-input" type="number" id="ep-p" value="${precio}"/></div>
      <div class="form-group"><label class="form-label">Emoji</label><input class="form-input" id="ep-i" value="${emoji}" maxlength="2"/></div>
    </div>
    <div class="m-btns">
      <button class="m-cancel-btn" onclick="closeModal()">Cancelar</button>
      <button class="m-save-btn red" onclick="eliminarProducto('${id}')" style="flex:1">Eliminar</button>
      <button class="m-save-btn" onclick="saveEditProducto('${id}')">Guardar</button>
    </div>`)
}

window.saveEditProducto = async function(id) {
  const {error}=await sb.from('productos').update({
    nombre:document.getElementById('ep-n').value,
    precio:+document.getElementById('ep-p').value,
    emoji:document.getElementById('ep-i').value||'ğŸ“¦',
  }).eq('id',id)
  if(error){showToast('âŒ '+error.message);return}
  closeModal(); await renderFinanzas(); showToast('âœ… Producto actualizado')
}

window.eliminarProducto = async function(id) {
  const {error}=await sb.from('productos').update({activo:false}).eq('id',id)
  if(error){showToast('âŒ '+error.message);return}
  closeModal(); await renderFinanzas(); showToast('ğŸ—‘ Producto eliminado')
}

window.openNuevoMultiplicador = function() {
  openModal(`
    <div class="m-head"><div class="m-title">Multiplicador</div><button class="m-x" onclick="closeModal()">Ã—</button></div>
    <div class="form-group"><label class="form-label">DÃ­a</label>
      <select class="form-select" id="nm-d">${DIAS_FULL.map(d=>`<option>${d}</option>`).join('')}</select></div>
    <div class="form-group"><label class="form-label">Incremento (%)</label><input class="form-input" type="number" id="nm-v" placeholder="25"/></div>
    <div class="form-group"><label class="form-label">DescripciÃ³n</label><input class="form-input" id="nm-desc" placeholder="Precio fin de semana..."/></div>
    <div class="m-btns">
      <button class="m-cancel-btn" onclick="closeModal()">Cancelar</button>
      <button class="m-save-btn" onclick="guardarMultiplicador()">Guardar</button>
    </div>`)
}

window.guardarMultiplicador = function() {
  const dia=document.getElementById('nm-d').value
  const val=+document.getElementById('nm-v').value||0
  const desc=document.getElementById('nm-desc').value||'Precio especial'
  multiplicadores.push({dia,val:`+${val}%`,tipo:'up',desc})
  closeModal(); renderMultiplicadores(); showToast('âœ… Multiplicador guardado')
}

// â•â•â• UTILS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showToast(msg) {
  const t=document.getElementById('toast'); t.querySelector('#t-msg').textContent=msg
  t.classList.add('show'); clearTimeout(t._t); t._t=setTimeout(()=>t.classList.remove('show'),3500)
}

function timeSince(dateStr) {
  const d=new Date(dateStr); const now=new Date()
  const mins=Math.floor((now-d)/60000)
  if(mins<60) return `hace ${mins}m`
  const hrs=Math.floor(mins/60)
  if(hrs<24) return `hace ${hrs}h`
  return `hace ${Math.floor(hrs/24)}d`
}

// Auto-focus PIN
setTimeout(()=>document.getElementById('pin-input')?.focus(), 100)
</script>
</body>
</html>